
<html>
  <head>
    <meta charset="UTF-8"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.10.2/underscore-min.js" type="text/javascript"></script>
    <script src="https://app.roll20dev.net/v2/js/jquery-1.9.1.js" type="text/javascript"></script>
    <script src="https://app.roll20dev.net/v2/js/jquery.migrate.js" type="text/javascript"></script>
    <script src="https://app.roll20dev.net/js/jquery-ui.1.9.0.custom.min.js" type="text/javascript"></script>
    <script>var roll20API = {
    events: {},
    charData: {},
    repItemId: 0,
};

function on(eventStr, fnc) {
    _.each(eventStr.split(" "), function (ev) {
        if (roll20API.events[ev] == undefined) {
            roll20API.events[ev] = [];
        }
        roll20API.events[ev].push(fnc);
    });
}

function throwEvent(ev, eventInfo) {
    _.each(roll20API.events[ev], function (evCb) {
        evCb(eventInfo);
    });
}

async function setAttrs(obj, opt = "", cb = function () { }) {
    _.each(obj, function (value, key) {
        var eventInfo = {};
        eventInfo.newValue = value;
        eventInfo.previousValue = roll20API.charData[key];
        eventInfo.sourceAttribute = key.toLowerCase();

        if (value == eventInfo.previousValue) {
            cb();
            return;
        }

        roll20API.charData[key] = value;
        if (opt != "silent") {


            throwEvent("change:" + key, eventInfo);
        }

        var elementName = "attr_" + key;

        $(`span[name="${elementName}"], input[name="${elementName}"], select[name="${elementName}"], textarea[name="${elementName}"]`).each(function () {
            var el = $(this);
            var tagName = this.tagName;

            if (value != undefined) {
                if (tagName == "SPAN" || tagName == "TEXTAREA") {
                    el.text(value);
                } else {
                    if (el.attr("type") == "checkbox" || el.attr("type") == "radio") {
                        if (el.attr("type") == "checkbox") {
                            el.prop("checked", el.val() == value);
                        } else {
                            if (el.val() == value) {
                                el.prop("checked", true);
                            }
                        }
                    } else {
                        el.val(value);
                    }
                }
            }
            el.trigger("change");
        });


        if (key.startsWith("repeating_")) {
            rowId = key.match(/(repeating_[^_]*)_([^_]*)_([^_]*)/);

            if (rowId) {
                roll20API.charData[`_lastId_${rowId[1]}`] = rowId[2];
            } else {
                rowId = key.match(/(repeating_[^_]*)_([^_]*)/);
                rowId[3] = rowId[2];
                rowId[2] = roll20API.charData[`_lastId_${rowId[1]}`];
                eventInfo.sourceAttribute = (`${rowId[1]}_${rowId[2]}_${rowId[3]}`).toLowerCase();
            }
            var repOrder = [];
            if (roll20API.charData["_reporder:" + rowId[1]] != undefined) {
                repOrder = roll20API.charData["_reporder:" + rowId[1]].split(",").filter(v => v.match(/[0-9]+/));
            }

            if (rowId[2].startsWith("$")) {
                var temp = rowId[2].substr(1);
                rowId[2] = repOrder[+temp];
            }



            if (!repOrder.includes(rowId[2])) {
                addRepeatingRow($(`.repcontainer[data-groupname="${rowId[1]}"]`), rowId[1], rowId[2]);
            }

            roll20API.charData[`${rowId[1]}_${rowId[3]}`] = value;


            var elementName = "attr_" + rowId[3];

            $(`.repcontainer[data-groupname="${rowId[1]}"] .repitem[reprowid="${rowId[2]}"] input[name="${elementName}"],
            .repcontainer[data-groupname="${rowId[1]}"] .repitem[reprowid="${rowId[2]}"] select[name="${elementName}"],
            .repcontainer[data-groupname="${rowId[1]}"] .repitem[reprowid="${rowId[2]}"] span[name="${elementName}"],
            .repcontainer[data-groupname="${rowId[1]}"] .repitem[reprowid="${rowId[2]}"] textarea[name="${elementName}"]`).each(function () {
                var el = $(this);
                var tagName = this.tagName;

                if (value != undefined) {
                    if (tagName == "SPAN" || tagName == "TEXTAREA") {
                        el.text(value);
                    } else {
                        if (el.attr("type") == "checkbox" || el.attr("type") == "radio") {
                            if (el.attr("type") == "checkbox") {
                                el.prop("checked", el.val() == value);
                            } else {
                                if (el.val() == value) {
                                    el.prop("checked", true);
                                }
                            }

                        } else {
                            el.val(value);
                        }
                    }
                }
                el.trigger("change");
            });

            if (opt != "silent") {
                throwEvent("change:" + rowId[3], eventInfo);
                throwEvent("change:" + rowId[1], eventInfo);
                throwEvent("change:" + rowId[1] + ":" + rowId[3], eventInfo);
            }
        }





    });

    cb();
}

async function getAttrs(lst, cb) {
    var data = {};
    _.each(lst, function (value) {
        if (value.startsWith("repeating_")) {
            var rowId = value.match(/(repeating_[^_]*)_([^_]*)_([^_]*)/);
            if (rowId) {
                if (rowId[2].startsWith("$")) {
                    var repOrder = [];
                    if (roll20API.charData["_reporder:" + rowId[1]] != undefined) {
                        repOrder = roll20API.charData["_reporder:" + rowId[1]].split(",").filter(v => v.match(/[0-9]+/));
                    }
                    var temp = rowId[2].substr(1);
                    rowId[2] = repOrder[+temp];
                }
                data[value] = roll20API.charData[`${rowId[1]}_${rowId[2]}_${rowId[3]}`];
            } else {
                rowId = value.match(/(repeating_[^_]*)_([^_]*)/);
                rowId[3] = rowId[2];
                rowId[2] = roll20API.charData[`_lastId_${rowId[1]}`];
                data[value] = roll20API.charData[`${rowId[1]}_${rowId[2]}_${rowId[3]}`];
            }

        } else {
            data[value] = roll20API.charData[value];
        }

    });
    cb(data);
}

function generateRowID() {
    if (roll20API.charData._lastRepItemId == undefined) {
        roll20API.charData._lastRepItemId = 0;
    }
    return roll20API.charData._lastRepItemId++;
}

Array.prototype.unique = function () {
    return this.filter(function (value, index, self) {
        return self.indexOf(value) === index;
    });
}

async function getSectionIDs(sectionName, cb) {
    if (roll20API.charData["_reporder:" + sectionName] == undefined) {
        cb([]);
    } else {
        cb(roll20API.charData["_reporder:" + sectionName].split(",").filter(v => v != ""));
    }


}


function removeRepeatingRow(rowId) {

    rowId = rowId.match(/(repeating_[^_]*)_([^_]*)/);

    $(`div[data-groupname="${rowId[1]}"] div.repitem[reprowid="${rowId[2]}"]`).remove().parent().trigger('sortupdate');

    var props = Object.keys(roll20API.charData);

    var filteredProps = props.filter(prop => prop.startsWith(`${rowId[0]}`));
    eventInfo = {};
    eventInfo.removedInfo = {}
    filteredProps.forEach(function (prop) {
        eventInfo.removedInfo[prop] = roll20API.charData[prop];
        delete roll20API.charData[prop];
    });

    roll20API.charData["_reporder:" + rowId[1]] = roll20API.charData["_reporder:" + rowId[1]].split(",").filter(v => (v != rowId[2] && v != ""));

    eventInfo.sourceAttribute = rowId[0];

    throwEvent("remove:" + rowId[0], eventInfo);
    throwEvent("remove:" + rowId[1], eventInfo);
}

function addRepeatingRow(repcontainer, dataGroupName, itemId) {
    if (roll20API.charData["_reporder:" + dataGroupName] == undefined) {
        roll20API.charData["_reporder:" + dataGroupName] = [];
    }
    var reporder = roll20API.charData["_reporder:" + dataGroupName].split(",").filter(v => v.match(/[0-9]+/));

    if (!reporder.includes(itemId)) {
        reporder.push(itemId);
    }

    roll20API.charData["_reporder:" + dataGroupName] = reporder;


    repcontainer
        .append(`<div class="repitem" reprowid="${itemId}">
                <div class="itemcontrol">
                    <button class="btn btn-danger pictos repcontrol_del">#</button>
                    <a class="btn repcontrol_move">â‰¡</a>
                </div >`+ $(`fieldset[class="${dataGroupName}"]`).html() + '</div>');

    repcontainer.find(`.repitem[reprowid="${itemId}"] .itemcontrol button.repcontrol_del`).click(function (e) {
        e.preventDefault();

        removeRepeatingRow(`${dataGroupName}_${itemId}`);
    });

    repcontainer.find(`.repitem[reprowid="${itemId}"] input[name^="attr_"], .repitem[reprowid="${itemId}"] select[name^="attr_"], .repitem[reprowid="${itemId}"] textarea[name^="attr_"]`).change(function () {
        var data = {};
        if ($(this).attr("type") == "checkbox" || $(this).attr("type") == "radio") {
            if ($(this).prop("checked")) {
                data[`${dataGroupName}_${itemId}_${this.name.substr(5)}`] = this.value;
            } else {
                data[`${dataGroupName}_${itemId}_${this.name.substr(5)}`] = "";
            }

        } else {
            data[`${dataGroupName}_${itemId}_${this.name.substr(5)}`] = this.value;
        }

        setAttrs(data);
    });

    repcontainer.find("button[type=action]").click(function (e) {
        e.preventDefault();


        roll20API.charData[`_lastId_${dataGroupName}`] = itemId;
        throwEvent("clicked:" + `${dataGroupName}_${itemId}_${this.name.substr(4)}`, {});
        throwEvent("clicked:" + `${dataGroupName}:${this.name.substr(4)}`, {});
        throwEvent("clicked:" + `${dataGroupName}`, {});
        throwEvent("clicked:" + `${this.name.substr(4)}`, {});
    });

    repcontainer.find("button[type=roll]").click(function (e) {
        e.preventDefault();

    });


    repcontainer.trigger('sortupdate');

    repcontainer.find(`.repitem[reprowid="${itemId}"] input[name^="attr_"], 
    .repitem[reprowid="${itemId}"] select[name^="attr_"], 
    .repitem[reprowid="${itemId}"] span[name^="attr_"], 
    .repitem[reprowid="${itemId}"] textarea[name^="attr_"]`).each(function () {
        var attrName = `${dataGroupName}_${itemId}_${this.getAttribute("name").substr(5)}`;
        var el = $(this);
        var tagName = this.tagName;

        getAttrs([attrName], function (data) {
            if (data[attrName] != undefined) {
                if (tagName == "SPAN" || tagName == "TEXTAREA") {
                    el.text(data[attrName]);
                } else {
                    if (el.attr("type") == "checkbox" || el.attr("type") == "radio") {
                        el.prop("checked", el.val() == data[attrName]);
                    } else {
                        el.val(data[attrName]);
                    }
                }
            }
        });
    }).trigger("change");
}


$(document).ready(function () {

    roll20API.charData = window.localStorage;




    $('input[name^="attr_"], select[name^="attr_"], textarea[name^="attr_"]').change(function () {
        var data = {};
        if ($(this).attr("type") == "checkbox" || $(this).attr("type") == "radio") {
            if ($(this).prop("checked")) {
                data[this.name.substr(5)] = this.value;
            } else {
                if ($(this).attr("type") == "checkbox") {
                    data[this.name.substr(5)] = "";
                }

            }

        } else {
            data[this.name.substr(5)] = this.value;
        }

        setAttrs(data);
    });

    $('input[name^="attr_"], select[name^="attr_"], span[name^="attr_"], textarea[name^="attr_"]').each(function () {
        var attrName = this.getAttribute("name").substr(5);
        var el = $(this);
        var tagName = this.tagName;

        getAttrs([attrName], function (data) {
            if (data[attrName] != undefined) {
                if (tagName == "SPAN" || tagName == "TEXTAREA") {
                    el.text(data[attrName]);
                } else {
                    if (el.attr("type") == "checkbox" || el.attr("type") == "radio") {
                        el.prop("checked", el.val() == data[attrName]);
                    } else {
                        el.val(data[attrName]);
                    }
                }
            }
        });
    }).trigger("change");

    $("button[type=action]").click(function (e) {
        e.preventDefault();

        throwEvent("clicked:" + this.name.substr(4), {});

    });

    $("button[type=roll]").click(function (e) {
        e.preventDefault();

    });

    $("fieldset[class^='repeating_']").each(function () {
        this.style = "display: none";
        var repName = this.className.match(/repeating_([^_]*)/);

        $(this).after(`<div class="repcontainer ui-sortable" data-groupname="${repName[0]}"></div>
        <div class="repcontrol" data-groupname="${repName[0]}">
            <button class="btn repcontrol_edit">Modify</button>
            <button class="btn repcontrol_add">+Add</button>
        </div>`);

        if (roll20API.charData["_reporder:" + repName[0]] == undefined) {
            roll20API.charData["_reporder:" + repName[0]] = [];
        }

        var repcontainer = $(this).next();
        var reporder = roll20API.charData["_reporder:" + repName[0]].split(",").filter(v => v.match(/[0-9]+/));
        if (reporder.length > 0) {
            reporder.forEach(function (key) {
                addRepeatingRow(repcontainer, repName[0], key);
            });
        } else {
            Object.keys(roll20API.charData).filter(key => key.startsWith(repName[0] + "_")).forEach(function (key) {
                rowId = key.match(/(repeating_[^_]*)_([^_]+)_.*/);
                if (rowId) {
                    if (repcontainer.find(`.repitem[reprowid="${rowId[2]}"]`).length == 0) {
                        addRepeatingRow(repcontainer, rowId[1], rowId[2]);
                    }
                }

            });
        }


        $(this).next().sortable(
            {
                connectWith: `.ui-sortable[data-groupname="${repName[0]}"]`,
                handle: '.repcontrol_move',
                update: function (event, ui) {
                    var repOrder = ui.item.parent().children().map(function (idx) {
                        return $(this).attr("reprowid");
                    });
                    repOrder = $.makeArray(repOrder).filter(v => v.match(/[0-9]+/));
                    console.log(repOrder);
                    roll20API.charData["_reporder:" + repName[0]] = $.makeArray(repOrder);
                    throwEvent("change:_reporder:" + repName[0]);
                }
            }
        );
    });

    $("button[class='btn repcontrol_add']").click(function (e) {
        e.preventDefault();
        var dataGroupName = $(this).parent().attr("data-groupname");
        repcontainer = $(this).parent().prev();

        var itemId = generateRowID();

        addRepeatingRow(repcontainer, dataGroupName, itemId)
    });

    $("button[class='btn repcontrol_edit']").click(function (e) {
        e.preventDefault();
        repcontainer = $(this).parent().prev();

        if (repcontainer.hasClass("editmode")) {
            repcontainer.removeClass("editmode");
            $(this).text("Modify");
            $(this).next().removeAttr("style");
        } else {
            repcontainer.addClass("editmode");
            $(this).text("Done");
            $(this).next().css({ "display": "none" });
        }




    });

    $(document).on("click", "button[type='roll']", function (e) {
        e.preventDefault();
        var reprowid = $(this).parents("[reprowid]").attr("reprowid");
        var dataGroupname = $(this).parents("[data-groupname]").attr("data-groupname");
        var rollCmd = $(this).val();

        rollCmd = rollCmd.replace(/.*@\{([^\}:]+)\}.*/g, function (match, submatch) {
            if (roll20API.charData[`${dataGroupname}_${reprowid}_${submatch}`] != undefined) {
                return roll20API.charData[`${dataGroupname}_${reprowid}_${submatch}`];
            } else {
                return roll20API.charData[submatch];
            }
        })

        var rollParser = function (rollCmd) {
            rollCmd = rollCmd.replace(/.*\[\[(.*)\]\].*/g, function (match, submatch) {
                rollParser(submatch)
            });

            rollCmd = rollCmd.replace(/.*([0-9]*)[dD]([0-9]+)([dk<]*).*/g, function (match, nDices, diceType, diceOptions) {
                nDices = nDices || 1;

                Math.random
            });
        }



        console.log(`invoke roll (${dataGroupname}_${reprowid}): ${rollCmd}`);
        console.log(e);
    });


    $("script[type='text/worker']").each(function () {
        eval(this.innerHTML);
    });


    throwEvent("sheet:opened", {});
});
    </script>
    <script>
      $(document).ready(function () {
          $('.characterdialog').dialog({width: 960, height: 800});
      });
    </script>
    <link rel="stylesheet" href="https://app.roll20dev.net/assets/base.css" type="text/css"/>
    <link rel="stylesheet" href="https://app.roll20.net/assets/app.css" type="text/css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Patrick+Hand|Contrail+One|Shadows+Into+Light|Candal&amp;amp;subset=latin,latin-ext" type="text/css"/>
    <link rel="stylesheet" href="sheet.css" type="text/css"/>
    <title>Roll20 - Splittermond</title>
  </head>
  <body class="no-touch">
    <div class="dialog characterdialog" title="Charaktername">
      <div class="dialog largedialog characterviewer" style="display: block">
        <ul class="nav nav-tabs">
          <li> <a href="javascript:void(0)" data-tab="bioinfo">Bio &amp; Info</a></li>
          <li class="active"><a href="javascript:void(0)" data-tab="charsheet">Charactersheet</a></li>
          <li><a href="javascript:void(0)" data-tab="attributesabilities">Attributes &amp; Abilities</a></li>
        </ul>
        <div class="tab-content">
          <form class="sheetform" autocomplete="off">
            <div class="charactersheet tab-pane charsheet lang-de" style="display: block">
<div class="sheet-splittermond">
  <input name="attr_pc" type="hidden" value="1"/>
  <div class="sheet-pc">
    <input name="attr_editmode" type="hidden" value=""/>
    <input name="attr_tab" type="hidden" value="grundwerte"/>
    <div class="sheet-tab-nav">
          <button type="action" name="act_einstellungen"><span class="sheet-icon">y</span>
          </button>
          <button type="action" name="act_grundwerte">
             Grundwerte
          </button>
          <button type="action" name="act_fertigkeiten">Fertigkeiten & Magie
          </button>
          <button type="action" name="act_kampf">
             Kampf &  Meisterschaften
          </button>
          <button type="action" name="act_ausruestung">AusrÃ¼stung
          </button>
      <label class="sheet-switch">
        <input type="checkbox" name="attr_editmode"/><span class="sheet-slider"></span><span class="sheet-active">edit</span><span class="sheet-inactive">play</span>
      </label>
    </div>
    <div class="sheet-tab-nav-shadow"></div>
    <div class="sheet-roll-options">
      <h2>Probenoption</h2>
      <div class="sheet-data-section-row"><span>
          <label>Modifikator</label><span>
            <button class="sheet-incdec" type="action" name="act_decmod">_</button>
            <input name="attr_probenmodifikator" type="number" value="0"/>
            <button class="sheet-incdec" type="action" name="act_incmod">&</button></span></span><span>
          <label>Schwierigkeit</label><span>
            <button class="sheet-incdec" type="action" name="act_decschwierigkeit">_</button>
            <input name="attr_probenschwierigkeit" type="number" value="15"/>
            <button class="sheet-incdec" type="action" name="act_incschwierigkeit">&</button></span></span><span>
          <label>Wurfoption</label><span class="sheet-switch-field">
            <label>
              <input name="attr_probenwurfoption" type="radio" value="[[{[[1d10]], [[0]], [[0]], [[0]]}k1]]"/><span>Sicherheit</span>
            </label>
            <label>
              <input name="attr_probenwurfoption" type="radio" value="[[{[[1d10]], [[1d10]], [[0]], [[0]]}k2]]"/><span>Standard</span>
            </label>
            <label> 
              <input name="attr_probenwurfoption" type="radio" value="[[{[[[[1d10]], [[1d10]], [[1d10]], [[1d10]]]}k2]]"/><span>Risiko</span>
            </label></span></span><span>
          <label>Sichtbarkeit</label>
          <label class="sheet-switch">
            <input type="checkbox" name="attr_probensichtbarkeit" value="/w GM"/><span class="sheet-slider"></span><span class="sheet-active">GM</span><span class="sheet-inactive">Alle</span>
          </label></span></div>
    </div>
    <div class="sheet-roll-options-shadow sheet-play-only"></div>
    <div class="sheet-tab-group sheet-paper">
      <div class="sheet-watermark">
        <div class="sheet-tab-content sheet-einstellungen">
          <h2>Einstellungen</h2>
          <div>7<span class="sheet-autoexpand">
              <input name="attr_test" type="text" value="7"/><span class="sheet-autoexpand" name="attr_test"></span></span>&nbsp(+<span class="sheet-autoexpand">
              <input name="attr_testmod" type="text" value="0"/><span class="sheet-autoexpand" name="attr_testmod"></span></span>)
          </div>
        </div>
        <div class="sheet-tab-content sheet-grundwerte">
          <h1><span class="sheet-autoexpand" placeholder="Charaktername">
              <input name="attr_character_name" type="text" value="" placeholder="Charaktername"/><span class="sheet-autoexpand" name="attr_character_name" placeholder="Charaktername"></span></span>&middot;<span class="sheet-autoexpand" placeholder="Spielername">
              <input name="attr_spielername" type="text" value="" placeholder="Spielername"/><span class="sheet-autoexpand" name="attr_spielername" placeholder="Spielername"></span></span>
          </h1>
          <div class="sheet-data-section-personal">
            <div class="sheet-data-set sheet-data-set-rasse">
              <label>Rasse</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_rasse" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_rasse" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-kultur">
              <label>Kultur</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_kultur" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_kultur" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-abstammung">
              <label>Abstammung</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_abstammung" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_abstammung" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-ausbildung">
              <label>Ausbildung</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_ausbildung" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_ausbildung" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-geschlecht">
              <label>Geschlecht</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_geschlecht" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_geschlecht" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-groesse">
              <label>GrÃ¶ÃŸe</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_groesse" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_groesse" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-gewicht">
              <label>Gewicht</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_gewicht" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_gewicht" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-haarfarbe">
              <label>Haarfarbe</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_haarfarbe" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_haarfarbe" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-augenfarbe">
              <label>Augenfarbe</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_augenfarbe" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_augenfarbe" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-hautfarbe">
              <label>Hautfarbe</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_hautfarbe" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_hautfarbe" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-geburtsort">
              <label>Geburtsort</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_geburtsort" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_geburtsort" placeholder="-"></span></span>
            </div>
            <div class="sheet-data-set sheet-data-set-mondzeichen">
              <label>Mondzeichen</label><span class="sheet-autoexpand" placeholder="-">
                <input name="attr_mondzeichen" type="text" value="" placeholder="-"/><span class="sheet-autoexpand" name="attr_mondzeichen" placeholder="-"></span></span>
            </div>
          </div>
          <div class="sheet-data-section-row">
            <div class="sheet-data-section-attribute">
              <div class="sheet-data-header">
                <h3>Attribute</h3><span></span><span class="sheet-edit-only">Start</span><span class="sheet-edit-only">Basis</span><span class="sheet-edit-only">Mod.</span>
              </div>
              <div class="sheet-data-area">
                <label>AUS<span class="sheet-secondary">Ausstrahlung</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_ausstrahlung"></span><span class="sheet-tooltiptext sheet-pre" name="attr_ausstrahlungtooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_ausstrahlungstart" type="number" value="0"/></span><span class="sheet-tooltip sheet-edit-only">
                  <input name="attr_ausstrahlungbasis" type="number" value="0"/><span class="sheet-tooltiptext">
                     Max:&nbsp;<span name="attr_ausstrahlungmax"> </span></span></span><span class="sheet-edit-only">
                  <input name="attr_ausstrahlungmod" type="hidden" value="0"/>
                  <input name="attr_ausstrahlungmoduser" type="number" value="0"/></span>
                <label>BEW<span class="sheet-secondary">Beweglichkeit</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_beweglichkeit"></span><span class="sheet-tooltiptext sheet-pre" name="attr_beweglichkeittooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_beweglichkeitstart" type="number" value="0"/></span><span class="sheet-tooltip sheet-edit-only">
                  <input name="attr_beweglichkeitbasis" type="number" value="0"/><span class="sheet-tooltiptext">
                     Max:&nbsp;<span name="attr_beweglichkeitmax"> </span></span></span><span class="sheet-edit-only">
                  <input name="attr_beweglichkeitmod" type="hidden" value="0"/>
                  <input name="attr_beweglichkeitmoduser" type="number" value="0"/></span>
                <label>INT<span class="sheet-secondary">Intuition</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_intuition"></span><span class="sheet-tooltiptext sheet-pre" name="attr_intuitiontooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_intuitionstart" type="number" value="0"/></span><span class="sheet-tooltip sheet-edit-only">
                  <input name="attr_intuitionbasis" type="number" value="0"/><span class="sheet-tooltiptext">
                     Max:&nbsp;<span name="attr_intuitionmax"> </span></span></span><span class="sheet-edit-only">
                  <input name="attr_intuitionmod" type="hidden" value="0"/>
                  <input name="attr_intuitionmoduser" type="number" value="0"/></span>
                <label>KON<span class="sheet-secondary">Konstitution</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_konstitution"></span><span class="sheet-tooltiptext sheet-pre" name="attr_konstitutiontooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_konstitutionstart" type="number" value="0"/></span><span class="sheet-tooltip sheet-edit-only">
                  <input name="attr_konstitutionbasis" type="number" value="0"/><span class="sheet-tooltiptext">
                     Max:&nbsp;<span name="attr_konstitutionmax"> </span></span></span><span class="sheet-edit-only">
                  <input name="attr_konstitutionmod" type="hidden" value="0"/>
                  <input name="attr_konstitutionmoduser" type="number" value="0"/></span>
                <label>MYS<span class="sheet-secondary">Mystik</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_mystik"></span><span class="sheet-tooltiptext sheet-pre" name="attr_mystiktooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_mystikstart" type="number" value="0"/></span><span class="sheet-tooltip sheet-edit-only">
                  <input name="attr_mystikbasis" type="number" value="0"/><span class="sheet-tooltiptext">
                     Max:&nbsp;<span name="attr_mystikmax"> </span></span></span><span class="sheet-edit-only">
                  <input name="attr_mystikmod" type="hidden" value="0"/>
                  <input name="attr_mystikmoduser" type="number" value="0"/></span>
                <label>STÃ„<span class="sheet-secondary">StÃ¤rke</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_staerke"></span><span class="sheet-tooltiptext sheet-pre" name="attr_staerketooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_staerkestart" type="number" value="0"/></span><span class="sheet-tooltip sheet-edit-only">
                  <input name="attr_staerkebasis" type="number" value="0"/><span class="sheet-tooltiptext">
                     Max:&nbsp;<span name="attr_staerkemax"> </span></span></span><span class="sheet-edit-only">
                  <input name="attr_staerkemod" type="hidden" value="0"/>
                  <input name="attr_staerkemoduser" type="number" value="0"/></span>
                <label>VER<span class="sheet-secondary">Verstand</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_verstand"></span><span class="sheet-tooltiptext sheet-pre" name="attr_verstandtooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_verstandstart" type="number" value="0"/></span><span class="sheet-tooltip sheet-edit-only">
                  <input name="attr_verstandbasis" type="number" value="0"/><span class="sheet-tooltiptext">
                     Max:&nbsp;<span name="attr_verstandmax"> </span></span></span><span class="sheet-edit-only">
                  <input name="attr_verstandmod" type="hidden" value="0"/>
                  <input name="attr_verstandmoduser" type="number" value="0"/></span>
                <label>WIL<span class="sheet-secondary">Willenskraft</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_willenskraft"></span><span class="sheet-tooltiptext sheet-pre" name="attr_willenskrafttooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_willenskraftstart" type="number" value="0"/></span><span class="sheet-tooltip sheet-edit-only">
                  <input name="attr_willenskraftbasis" type="number" value="0"/><span class="sheet-tooltiptext">
                     Max:&nbsp;<span name="attr_willenskraftmax"> </span></span></span><span class="sheet-edit-only">
                  <input name="attr_willenskraftmod" type="hidden" value="0"/>
                  <input name="attr_willenskraftmoduser" type="number" value="0"/></span>
              </div>
            </div>
            <div class="sheet-data-section-abgeleitetewerte">
              <div class="sheet-data-header">
                <h3>Abgeleitete Werte</h3><span></span><span class="sheet-edit-only">Mod.</span>
              </div>
              <div class="sheet-data-area">
                <label>GK<span class="sheet-secondary">GrÃ¶ÃŸenklasse</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_groessenklasse"></span><span class="sheet-tooltiptext sheet-pre" name="attr_groessenklassetooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_groessenklassemoduser" type="number" value="0"/>
                  <input name="attr_groessenklassemod" type="hidden" value="0"/></span>
                <label>GSW<span class="sheet-secondary">Geschwindigkeit</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_geschwindigkeit"></span><span class="sheet-tooltiptext sheet-pre" name="attr_geschwindigkeittooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_geschwindigkeitmoduser" type="number" value="0"/>
                  <input name="attr_geschwindigkeitmod" type="hidden" value="0"/></span>
                <label>INI<span class="sheet-secondary">Initiative</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_initiative"></span><span class="sheet-tooltiptext sheet-pre" name="attr_initiativetooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_initiativemoduser" type="number" value="0"/>
                  <input name="attr_initiativemod" type="hidden" value="0"/></span>
                <label>LP<span class="sheet-secondary">Lebenspunkte</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_lebenspunkte"></span><span class="sheet-tooltiptext sheet-pre" name="attr_lebenspunktetooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_lebenspunktemoduser" type="number" value="0"/>
                  <input name="attr_lebenspunktemod" type="hidden" value="0"/></span>
                <label>FO<span class="sheet-secondary">Fokus</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_fokus"></span><span class="sheet-tooltiptext sheet-pre" name="attr_fokustooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_fokusmoduser" type="number" value="0"/>
                  <input name="attr_fokusmod" type="hidden" value="0"/></span>
                <label>VTD<span class="sheet-secondary">Verteidigung</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_verteidigung"></span><span class="sheet-tooltiptext sheet-pre" name="attr_verteidigungtooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_verteidigungmoduser" type="number" value="0"/>
                  <input name="attr_verteidigungmod" type="hidden" value="0"/></span>
                <label>GW<span class="sheet-secondary">Geistiger Widerstand</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_geistigerwiderstand"></span><span class="sheet-tooltiptext sheet-pre" name="attr_geistigerwiderstandtooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_geistigerwiderstandmoduser" type="number" value="0"/>
                  <input name="attr_geistigerwiderstandmod" type="hidden" value="0"/></span>
                <label>KW<span class="sheet-secondary">KÃ¶rperlicher Widerstand</span></label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_koerperlicherwiderstand"></span><span class="sheet-tooltiptext sheet-pre" name="attr_koerperlicherwiderstandtooltip"></span></span><span class="sheet-edit-only">
                  <input name="attr_koerperlicherwiderstandmoduser" type="number" value="0"/>
                  <input name="attr_koerperlicherwiderstandmod" type="hidden" value="0"/></span>
              </div>
            </div>
            <div class="sheet-data-section-erfahrungspunkte">
              <div class="sheet-data-header">
                <h3>Erfahrungspunkte</h3>
              </div>
              <div class="sheet-data-area">
                <label>Gesamt</label>
                <input name="attr_epgesamt" type="number" value="0"/>
                <label>Eingesetzt</label>
                <input name="attr_epeingesetzt" type="number" value="0"/>
                <label>Offen</label><span name="attr_epoffen"></span>
                <label>Heldengrad</label><span name="attr_heldengrad"></span>
              </div>
            </div>
          </div>
          <div class="sheet-data-section-row">
            <div class="sheet-data-section-ressourcen">
              <div class="sheet-data-header">
                <h3>Ressourcen</h3>
              </div>
              <div class="sheet-data-area">
                <fieldset class="repeating_ressources">
                  <input name="attr_ressourcename" type="text" value="" placeholder="Ressource"/>
                  <input name="attr_ressourcevalue" type="number" value="1"/>
                </fieldset>
                <input name="attr_resourceupdated" type="hidden" value="0"/>
              </div>
            </div>
            <div class="sheet-data-section-staerken">
              <div class="sheet-data-header">
                <h3>StÃ¤rken</h3>
              </div>
              <div class="sheet-data-area">
                <input name="attr_staerkenmod" type="hidden" value=""/>
                <fieldset class="repeating_staerken">
                  <input name="attr_staerkename" type="text" value="" placeholder="StÃ¤rke"/>
                  <input name="attr_staerkenwert" type="number" value="1"/>
                </fieldset>
              </div>
            </div>
            <div class="sheet-data-section-schwaechen">
              <div class="sheet-data-header">
                <h3>SchwÃ¤chen</h3>
              </div>
              <div class="sheet-data-area">
                <fieldset class="repeating_schwaechen">
                  <input name="attr_schwaeche" type="text" value="" placeholder="SchwÃ¤che"/>
                </fieldset>
              </div>
            </div>
          </div>
          <div class="sheet-data-section-row">
            <div class="sheet-data-section-sprachen">
              <div class="sheet-data-header">
                <h3>Sprachen</h3>
              </div>
              <div class="sheet-data-area">
                <fieldset class="repeating_sprachen">
                  <input name="attr_sprache" type="text" value="" placeholder="Sprache"/>
                </fieldset>
              </div>
            </div>
            <div class="sheet-data-section-kulturkunde">
              <div class="sheet-data-header">
                <h3>Kulturkunde</h3>
              </div>
              <div class="sheet-data-area">
                <fieldset class="repeating_kulturkunde">
                  <input name="attr_kulturkunde" type="text" value="" placeholder="Kultur"/>
                </fieldset>
              </div>
            </div>
          </div>
          <div class="sheet-data-section-attributmods">
            <div class="sheet-data-header">
              <h3>Modifikatoren (z.b. Kan. Zauber)</h3><span>Eigenschaft</span><span>Mod.</span>
            </div>
            <div class="sheet-data-area">
              <input name="attr_attributmodsmod" type="hidden" value=""/>
              <fieldset class="repeating_attributmods">
                <input name="attr_attributmodonoff" type="checkbox"/>
                <input name="attr_attributmodname" type="text" value="" placeholder="Zauber etc."/>
                <select name="attr_modattribut"> 
                  <optgroup label="Attribute">
                    <option value="ausstrahlung">Ausstrahlung</option>
                    <option value="beweglichkeit">Beweglichkeit</option>
                    <option value="intuition">Intuition</option>
                    <option value="konstitution">Konstitution</option>
                    <option value="mystik">Mystik</option>
                    <option value="staerke">StÃ¤rke</option>
                    <option value="verstand">Verstand</option>
                    <option value="willenskraft">Willenskraft</option>
                  </optgroup>
                  <optgroup label="Abgeleitete Attribute">
                    <option value="groessenklasse">GrÃ¶ÃŸenklasse</option>
                    <option value="geschwindigkeit">Geschwindigkeit</option>
                    <option value="initiative">Initiative</option>
                    <option value="lebenspunkte">Lebenspunkte</option>
                    <option value="fokus">Fokus</option>
                    <option value="verteidigung">Verteidigung</option>
                    <option value="geistigerwiderstand">Geistiger Widerstand</option>
                    <option value="koerperlicherwiderstand">KÃ¶rperlicher Widerstand</option>
                    <option value="allwiderstand">Alle Widerst&auml;nde</option>
                  </optgroup>
                  <optgroup label="Kampfrelevantes">
                    <option value="behinderung">Behinderung</option>
                    <option value="schadensreduktion">Schadensreduktion</option>
                    <option value="angriff">Angriffe</option>
                    <option value="wundabzug">Wundabzug</option>
                  </optgroup>
                  <optgroup label="Fertigkeiten"><option value="allfertigkeiten">Alle Fertigkeiten</option>
<option value="magiefertigkeiten">Magie Fertigkeiten</option>
<option value="allgfertigkeiten">Allgemeine Fertigkeiten</option>
<option value="kampffertigkeiten">Kampffertigkeiten</option>
                  </optgroup>
                </select>
                <input name="attr_attributmod" type="number" value="1"/>
              </fieldset>
            </div>
          </div>
        </div>
        <div class="sheet-tab-content sheet-fertigkeiten">
          <div class="sheet-data-section-row">
            <div class="sheet-data-section-fertigkeiten">
              <div class="sheet-data-header">
                <h3>Fertigkeiten</h3><span class="sheet-edit-only"></span><span class="sheet-edit-only">Pkt.</span><span class="sheet-edit-only">Mod.</span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{akrobatik} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Akrobatik}}"></button>
                <label>Akrobatik</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_akrobatik"></span><span class="sheet-tooltiptext"> 
                    <label>BEW</label><span name="attr_beweglichkeit">0</span>
                    <label>STÃ„</label><span name="attr_staerke">0</span><span class="sheet-pre" name="attr_akrobatiktooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_akrobatikpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_akrobatikmod" type="hidden" value="0"/>
                  <input name="attr_akrobatikmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{alchemie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Alchemie}}"></button>
                <label>Alchemie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_alchemie"></span><span class="sheet-tooltiptext"> 
                    <label>MYS</label><span name="attr_mystik">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_alchemietooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_alchemiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_alchemiemod" type="hidden" value="0"/>
                  <input name="attr_alchemiemoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{anfuehren} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=AnfÃ¼hren}}"></button>
                <label>AnfÃ¼hren</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_anfuehren"></span><span class="sheet-tooltiptext"> 
                    <label>AUS</label><span name="attr_ausstrahlung">0</span>
                    <label>WIL</label><span name="attr_willenskraft">0</span><span class="sheet-pre" name="attr_anfuehrentooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_anfuehrenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_anfuehrenmod" type="hidden" value="0"/>
                  <input name="attr_anfuehrenmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{arkanekunde} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Arkane Kunde}}"></button>
                <label>Arkane Kunde</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_arkanekunde"></span><span class="sheet-tooltiptext"> 
                    <label>MYS</label><span name="attr_mystik">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_arkanekundetooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_arkanekundepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_arkanekundemod" type="hidden" value="0"/>
                  <input name="attr_arkanekundemoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{athletik} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Athletik}}"></button>
                <label>Athletik</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_athletik"></span><span class="sheet-tooltiptext"> 
                    <label>BEW</label><span name="attr_beweglichkeit">0</span>
                    <label>STÃ„</label><span name="attr_staerke">0</span><span class="sheet-pre" name="attr_athletiktooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_athletikpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_athletikmod" type="hidden" value="0"/>
                  <input name="attr_athletikmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{darbietung} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Darbietung}}"></button>
                <label>Darbietung</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_darbietung"></span><span class="sheet-tooltiptext"> 
                    <label>AUS</label><span name="attr_ausstrahlung">0</span>
                    <label>WIL</label><span name="attr_willenskraft">0</span><span class="sheet-pre" name="attr_darbietungtooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_darbietungpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_darbietungmod" type="hidden" value="0"/>
                  <input name="attr_darbietungmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{diplomatie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Diplomatie}}"></button>
                <label>Diplomatie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_diplomatie"></span><span class="sheet-tooltiptext"> 
                    <label>AUS</label><span name="attr_ausstrahlung">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_diplomatietooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_diplomatiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_diplomatiemod" type="hidden" value="0"/>
                  <input name="attr_diplomatiemoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{edelhandwerk} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Edelhandwerk}}"></button>
                <label>Edelhandwerk</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_edelhandwerk"></span><span class="sheet-tooltiptext"> 
                    <label>INT</label><span name="attr_intuition">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_edelhandwerktooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_edelhandwerkpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_edelhandwerkmod" type="hidden" value="0"/>
                  <input name="attr_edelhandwerkmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{empathie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Empathie}}"></button>
                <label>Empathie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_empathie"></span><span class="sheet-tooltiptext"> 
                    <label>INT</label><span name="attr_intuition">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_empathietooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_empathiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_empathiemod" type="hidden" value="0"/>
                  <input name="attr_empathiemoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{entschlossenheit} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Entschlossenheit}}"></button>
                <label>Entschlossenheit</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_entschlossenheit"></span><span class="sheet-tooltiptext"> 
                    <label>AUS</label><span name="attr_ausstrahlung">0</span>
                    <label>WIL</label><span name="attr_willenskraft">0</span><span class="sheet-pre" name="attr_entschlossenheittooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_entschlossenheitpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_entschlossenheitmod" type="hidden" value="0"/>
                  <input name="attr_entschlossenheitmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{fingerfertigkeit} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Fingerfertigkeit}}"></button>
                <label>Fingerfertigkeit</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_fingerfertigkeit"></span><span class="sheet-tooltiptext"> 
                    <label>AUS</label><span name="attr_ausstrahlung">0</span>
                    <label>BEW</label><span name="attr_beweglichkeit">0</span><span class="sheet-pre" name="attr_fingerfertigkeittooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_fingerfertigkeitpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_fingerfertigkeitmod" type="hidden" value="0"/>
                  <input name="attr_fingerfertigkeitmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{geschichtenundmythen} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Geschichten &amp; Mythen}}"></button>
                <label>Geschichten &amp; Mythen</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_geschichtenundmythen"></span><span class="sheet-tooltiptext"> 
                    <label>MYS</label><span name="attr_mystik">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_geschichtenundmythentooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_geschichtenundmythenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_geschichtenundmythenmod" type="hidden" value="0"/>
                  <input name="attr_geschichtenundmythenmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{handwerk} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Handwerk}}"></button>
                <label>Handwerk</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_handwerk"></span><span class="sheet-tooltiptext"> 
                    <label>KON</label><span name="attr_konstitution">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_handwerktooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_handwerkpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_handwerkmod" type="hidden" value="0"/>
                  <input name="attr_handwerkmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{heilkunde} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Heilkunde}}"></button>
                <label>Heilkunde</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_heilkunde"></span><span class="sheet-tooltiptext"> 
                    <label>INT</label><span name="attr_intuition">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_heilkundetooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_heilkundepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_heilkundemod" type="hidden" value="0"/>
                  <input name="attr_heilkundemoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{heimlichkeit} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Heimlichkeit}}"></button>
                <label>Heimlichkeit</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_heimlichkeit"></span><span class="sheet-tooltiptext"> 
                    <label>BEW</label><span name="attr_beweglichkeit">0</span>
                    <label>INT</label><span name="attr_intuition">0</span><span class="sheet-pre" name="attr_heimlichkeittooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_heimlichkeitpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_heimlichkeitmod" type="hidden" value="0"/>
                  <input name="attr_heimlichkeitmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{jagdkunst} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Jagdkunst}}"></button>
                <label>Jagdkunst</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_jagdkunst"></span><span class="sheet-tooltiptext"> 
                    <label>KON</label><span name="attr_konstitution">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_jagdkunsttooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_jagdkunstpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_jagdkunstmod" type="hidden" value="0"/>
                  <input name="attr_jagdkunstmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{laenderkunde} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=LÃ¤nderkunde}}"></button>
                <label>LÃ¤nderkunde</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_laenderkunde"></span><span class="sheet-tooltiptext"> 
                    <label>INT</label><span name="attr_intuition">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_laenderkundetooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_laenderkundepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_laenderkundemod" type="hidden" value="0"/>
                  <input name="attr_laenderkundemoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{naturkunde} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Naturkunde}}"></button>
                <label>Naturkunde</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_naturkunde"></span><span class="sheet-tooltiptext"> 
                    <label>INT</label><span name="attr_intuition">0</span>
                    <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_naturkundetooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_naturkundepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_naturkundemod" type="hidden" value="0"/>
                  <input name="attr_naturkundemoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{redegewandtheit} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Redegewandtheit}}"></button>
                <label>Redegewandtheit</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_redegewandtheit"></span><span class="sheet-tooltiptext"> 
                    <label>AUS</label><span name="attr_ausstrahlung">0</span>
                    <label>WIL</label><span name="attr_willenskraft">0</span><span class="sheet-pre" name="attr_redegewandtheittooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_redegewandtheitpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_redegewandtheitmod" type="hidden" value="0"/>
                  <input name="attr_redegewandtheitmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{schloesserundfallen} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=SchlÃ¶sser &amp; Fallen}}"></button>
                <label>SchlÃ¶sser &amp; Fallen</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_schloesserundfallen"></span><span class="sheet-tooltiptext"> 
                    <label>INT</label><span name="attr_intuition">0</span>
                    <label>BEW</label><span name="attr_beweglichkeit">0</span><span class="sheet-pre" name="attr_schloesserundfallentooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_schloesserundfallenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_schloesserundfallenmod" type="hidden" value="0"/>
                  <input name="attr_schloesserundfallenmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{schwimmen} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Schwimmen}}"></button>
                <label>Schwimmen</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_schwimmen"></span><span class="sheet-tooltiptext"> 
                    <label>KON</label><span name="attr_konstitution">0</span>
                    <label>STÃ„</label><span name="attr_staerke">0</span><span class="sheet-pre" name="attr_schwimmentooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_schwimmenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_schwimmenmod" type="hidden" value="0"/>
                  <input name="attr_schwimmenmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{seefahrt} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Seefahrt}}"></button>
                <label>Seefahrt</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_seefahrt"></span><span class="sheet-tooltiptext"> 
                    <label>BEW</label><span name="attr_beweglichkeit">0</span>
                    <label>KON</label><span name="attr_konstitution">0</span><span class="sheet-pre" name="attr_seefahrttooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_seefahrtpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_seefahrtmod" type="hidden" value="0"/>
                  <input name="attr_seefahrtmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{strassenkunde} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=StraÃŸenkunde}}"></button>
                <label>StraÃŸenkunde</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_strassenkunde"></span><span class="sheet-tooltiptext"> 
                    <label>AUS</label><span name="attr_ausstrahlung">0</span>
                    <label>INT</label><span name="attr_intuition">0</span><span class="sheet-pre" name="attr_strassenkundetooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_strassenkundepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_strassenkundemod" type="hidden" value="0"/>
                  <input name="attr_strassenkundemoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{tierfuehrung} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Tierfuehrung}}"></button>
                <label>Tierfuehrung</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_tierfuehrung"></span><span class="sheet-tooltiptext"> 
                    <label>AUS</label><span name="attr_ausstrahlung">0</span>
                    <label>BEW</label><span name="attr_beweglichkeit">0</span><span class="sheet-pre" name="attr_tierfuehrungtooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_tierfuehrungpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_tierfuehrungmod" type="hidden" value="0"/>
                  <input name="attr_tierfuehrungmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{ueberleben} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Ãœberleben}}"></button>
                <label>Ãœberleben</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_ueberleben"></span><span class="sheet-tooltiptext"> 
                    <label>INT</label><span name="attr_intuition">0</span>
                    <label>KON</label><span name="attr_konstitution">0</span><span class="sheet-pre" name="attr_ueberlebentooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_ueberlebenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_ueberlebenmod" type="hidden" value="0"/>
                  <input name="attr_ueberlebenmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{wahrnehmung} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Wahrnehmung}}"></button>
                <label>Wahrnehmung</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_wahrnehmung"></span><span class="sheet-tooltiptext"> 
                    <label>INT</label><span name="attr_intuition">0</span>
                    <label>WIL</label><span name="attr_willenskraft">0</span><span class="sheet-pre" name="attr_wahrnehmungtooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_wahrnehmungpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_wahrnehmungmod" type="hidden" value="0"/>
                  <input name="attr_wahrnehmungmoduser" type="number" value="0"/></span>
              </div>
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{zaehigkeit} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=ZÃ¤higkeit}}"></button>
                <label>ZÃ¤higkeit</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_zaehigkeit"></span><span class="sheet-tooltiptext"> 
                    <label>KON</label><span name="attr_konstitution">0</span>
                    <label>WIL</label><span name="attr_willenskraft">0</span><span class="sheet-pre" name="attr_zaehigkeittooltip"></span></span></span><span class="sheet-edit-only"> 
                  <input name="attr_zaehigkeitpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                  <input name="attr_zaehigkeitmod" type="hidden" value="0"/>
                  <input name="attr_zaehigkeitmoduser" type="number" value="0"/></span>
              </div>
            </div>
            <div class="sheet-data-section-column">
              <div class="sheet-data-section-magieschulen">
                <div class="sheet-data-header">
                  <h3>Magieschulen</h3><span class="sheet-edit-only"> </span><span class="sheet-edit-only">Pkt.</span><span class="sheet-edit-only">Mod.</span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{bannmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Bannmagie}}"></button>
                  <label>Bannmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_bannmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>WIL</label><span name="attr_willenskraft">0</span><span class="sheet-pre" name="attr_bannmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_bannmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_bannmagiemod" type="hidden" value="0"/>
                    <input name="attr_bannmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{beherrschungsmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Beherrschungsmagie}}"></button>
                  <label>Beherrschungsmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_beherrschungsmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>WIL</label><span name="attr_willenskraft">0</span><span class="sheet-pre" name="attr_beherrschungsmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_beherrschungsmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_beherrschungsmagiemod" type="hidden" value="0"/>
                    <input name="attr_beherrschungsmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{bewegungsmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Bewegungsmagie}}"></button>
                  <label>Bewegungsmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_bewegungsmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>BEW</label><span name="attr_beweglichkeit">0</span><span class="sheet-pre" name="attr_bewegungsmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_bewegungsmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_bewegungsmagiemod" type="hidden" value="0"/>
                    <input name="attr_bewegungsmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{erkenntnismagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Erkenntnismagie}}"></button>
                  <label>Erkenntnismagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_erkenntnismagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_erkenntnismagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_erkenntnismagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_erkenntnismagiemod" type="hidden" value="0"/>
                    <input name="attr_erkenntnismagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{felsmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Fellsmagie}}"></button>
                  <label>Fellsmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_felsmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>KON</label><span name="attr_konstitution">0</span><span class="sheet-pre" name="attr_felsmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_felsmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_felsmagiemod" type="hidden" value="0"/>
                    <input name="attr_felsmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{feuermagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Feuermagie}}"></button>
                  <label>Feuermagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_feuermagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>AUS</label><span name="attr_ausstrahlung">0</span><span class="sheet-pre" name="attr_feuermagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_feuermagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_feuermagiemod" type="hidden" value="0"/>
                    <input name="attr_feuermagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{heilungsmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Heilungsmagie}}"></button>
                  <label>Heilungsmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_heilungsmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>AUS</label><span name="attr_ausstrahlung">0</span><span class="sheet-pre" name="attr_heilungsmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_heilungsmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_heilungsmagiemod" type="hidden" value="0"/>
                    <input name="attr_heilungsmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{illusionsmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Illusionsmagie}}"></button>
                  <label>Illusionsmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_illusionsmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>AUS</label><span name="attr_ausstrahlung">0</span><span class="sheet-pre" name="attr_illusionsmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_illusionsmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_illusionsmagiemod" type="hidden" value="0"/>
                    <input name="attr_illusionsmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{kampfmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Kampfmagie}}"></button>
                  <label>Kampfmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_kampfmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>STÃ„</label><span name="attr_staerke">0</span><span class="sheet-pre" name="attr_kampfmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_kampfmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_kampfmagiemod" type="hidden" value="0"/>
                    <input name="attr_kampfmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{lichtmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Lichtmagie}}"></button>
                  <label>Lichtmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_lichtmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>AUS</label><span name="attr_ausstrahlung">0</span><span class="sheet-pre" name="attr_lichtmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_lichtmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_lichtmagiemod" type="hidden" value="0"/>
                    <input name="attr_lichtmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{naturmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Naturmagie}}"></button>
                  <label>Naturmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_naturmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>AUS</label><span name="attr_ausstrahlung">0</span><span class="sheet-pre" name="attr_naturmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_naturmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_naturmagiemod" type="hidden" value="0"/>
                    <input name="attr_naturmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{schattenmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Schattenmagie}}"></button>
                  <label>Schattenmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_schattenmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>INT</label><span name="attr_intuition">0</span><span class="sheet-pre" name="attr_schattenmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_schattenmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_schattenmagiemod" type="hidden" value="0"/>
                    <input name="attr_schattenmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{schicksalsmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Schicksalsmagie}}"></button>
                  <label>Schicksalsmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_schicksalsmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>AUS</label><span name="attr_ausstrahlung">0</span><span class="sheet-pre" name="attr_schicksalsmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_schicksalsmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_schicksalsmagiemod" type="hidden" value="0"/>
                    <input name="attr_schicksalsmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{schutzmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Schutzmagie}}"></button>
                  <label>Schutzmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_schutzmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>AUS</label><span name="attr_ausstrahlung">0</span><span class="sheet-pre" name="attr_schutzmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_schutzmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_schutzmagiemod" type="hidden" value="0"/>
                    <input name="attr_schutzmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{staerkungsmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=StÃ¤rkungsmagie}}"></button>
                  <label>StÃ¤rkungsmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_staerkungsmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>STÃ„</label><span name="attr_staerke">0</span><span class="sheet-pre" name="attr_staerkungsmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_staerkungsmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_staerkungsmagiemod" type="hidden" value="0"/>
                    <input name="attr_staerkungsmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{todesmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Todesmagie}}"></button>
                  <label>Todesmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_todesmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_todesmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_todesmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_todesmagiemod" type="hidden" value="0"/>
                    <input name="attr_todesmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{verwandlungsmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Verwandlungsmagie}}"></button>
                  <label>Verwandlungsmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_verwandlungsmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>KON</label><span name="attr_konstitution">0</span><span class="sheet-pre" name="attr_verwandlungsmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_verwandlungsmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_verwandlungsmagiemod" type="hidden" value="0"/>
                    <input name="attr_verwandlungsmagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{wassermagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Wassermagie}}"></button>
                  <label>Wassermagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_wassermagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>INT</label><span name="attr_intuition">0</span><span class="sheet-pre" name="attr_wassermagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_wassermagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_wassermagiemod" type="hidden" value="0"/>
                    <input name="attr_wassermagiemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{windmagie} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=Windmagie}}"></button>
                  <label>Windmagie</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_windmagie"></span><span class="sheet-tooltiptext">
                      <label>MYS</label><span name="attr_mystik">0</span>
                      <label>VER</label><span name="attr_verstand">0</span><span class="sheet-pre" name="attr_windmagietooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_windmagiepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_windmagiemod" type="hidden" value="0"/>
                    <input name="attr_windmagiemoduser" type="number" value="0"/></span>
                </div>
              </div>
              <div class="sheet-data-section-kampffertigkeiten">
                <div class="sheet-data-header">
                  <h3>Kampffertigkeiten</h3><span class="sheet-edit-only"></span><span class="sheet-edit-only">Pkt.</span><span class="sheet-edit-only">Mod.</span>
                </div>
                <div class="sheet-data-area">
                  <label>Handgemenge</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_handgemenge"></span><span class="sheet-tooltiptext"><span class="sheet-pre" name="attr_handgemengetooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_handgemengepunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_handgemengemod" type="hidden" value="0"/>
                    <input name="attr_handgemengemoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <label>Hiebwaffen</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_hiebwaffen"></span><span class="sheet-tooltiptext"><span class="sheet-pre" name="attr_hiebwaffentooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_hiebwaffenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_hiebwaffenmod" type="hidden" value="0"/>
                    <input name="attr_hiebwaffenmoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <label>Kettenwaffen</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_kettenwaffen"></span><span class="sheet-tooltiptext"><span class="sheet-pre" name="attr_kettenwaffentooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_kettenwaffenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_kettenwaffenmod" type="hidden" value="0"/>
                    <input name="attr_kettenwaffenmoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <label>Klingenwaffen</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_klingenwaffen"></span><span class="sheet-tooltiptext"><span class="sheet-pre" name="attr_klingenwaffentooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_klingenwaffenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_klingenwaffenmod" type="hidden" value="0"/>
                    <input name="attr_klingenwaffenmoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <label>Stangenwaffen</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_stangenwaffen"></span><span class="sheet-tooltiptext"><span class="sheet-pre" name="attr_stangenwaffentooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_stangenwaffenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_stangenwaffenmod" type="hidden" value="0"/>
                    <input name="attr_stangenwaffenmoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <label>Schusswaffen</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_schusswaffen"></span><span class="sheet-tooltiptext"><span class="sheet-pre" name="attr_schusswaffentooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_schusswaffenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_schusswaffenmod" type="hidden" value="0"/>
                    <input name="attr_schusswaffenmoduser" type="number" value="0"/></span>
                </div>
                <div class="sheet-data-area">
                  <label>Wurfwaffen</label><span class="sheet-tooltip" style="z-index:1500"><span class="sheet-main-value" name="attr_wurfwaffen"></span><span class="sheet-tooltiptext"><span class="sheet-pre" name="attr_wurfwaffentooltip"></span></span></span><span class="sheet-edit-only">
                    <input name="attr_wurfwaffenpunkte" type="number" value="0"/></span><span class="sheet-edit-only">
                    <input name="attr_wurfwaffenmod" type="hidden" value="0"/>
                    <input name="attr_wurfwaffenmoduser" type="number" value="0"/></span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="sheet-tab-content sheet-kampf">
          <input name="attr_erschoepft" type="hidden" value="0"/>
          <input name="attr_lahm" type="hidden" value="0"/>
          <input name="attr_benommen" type="hidden" value="0"/>
          <input name="attr_verwundet" type="hidden" value="0"/>
          <div class="sheet-data-section-row">
            <div class="sheet-data-section-lebenspunkte">
              <div class="sheet-data-header">
                <h3>Gesundheit</h3>
              </div>
              <div class="sheet-data-area sheet-lebenspunkte">
                <input name="attr_lebenspunkte" type="hidden" value="0"/>
                <div class="sheet-gesundheitsstufen">
                  <input name="attr_wundabzug" type="hidden" value="0"/>
                  <input name="attr_gesundheitsstufe" type="hidden" value="1"/><span class="sheet-unverletzt">Unverletzt</span><span class="sheet-angeschlagen">Angeschlagen</span><span class="sheet-verletzt">Verletzt</span><span class="sheet-schwerverletzt">Schwer verletzt</span><span class="sheet-todgeweiht">Todgeweiht</span>
                </div>
                <div class="sheet-lebenspunkte">
                  <input name="attr_lebenspunkte_v" type="hidden" value="0"/>
                  <input name="attr_lebenspunkte_e" type="hidden" value="0"/>
                  <input name="attr_lebenspunkte_k" type="hidden" value="0"/>
                  <input name="attr_lebenspunkte_t" type="hidden" value="0"/>
                  <input name="attr_sr1" type="hidden" value="1"/>
                  <input name="attr_sr2" type="hidden" value="1"/><span class="sheet-verzehrt" name="attr_lebenspunkte_v_bar"></span><span class="sheet-erschoepft" name="attr_lebenspunkte_e_bar"></span><span class="sheet-kanalisiert" name="attr_lebenspunkte_k_bar"></span><span class="sheet-lebenspunkte-t" name="attr_lebenspunkte_t_bar"></span>
                </div>
              </div>
              <div class="sheet-data-area sheet-wundabzug">
                <label>Wundabzug</label><span name="attr_wundabzug"></span>
                <input name="attr_wundabzugmod" type="hidden" value="0"/>+
                <input name="attr_wundabzugmoduser" type="number" value=""/>
              </div>
            </div>
            <div class="sheet-data-section-zustaende">
              <div class="sheet-data-header">
                <h3>ZustÃ¤nde</h3>
              </div>
              <div class="sheet-data-area">
                <input name="attr_zustaendemod" type="hidden" value=""/>
                <fieldset class="repeating_zustaende">
                  <input name="attr_zustandonoff" type="checkbox" value="1"/>
                  <input name="attr_zustandsname" type="text" value="" placeholder="Zustand"/>
                  <input name="attr_zustandsstufe" type="number" value="1"/>
                </fieldset>
              </div>
            </div>
            <div class="sheet-data-section-fokus">
              <div class="sheet-data-header">
                <h3>Fokus</h3>
              </div>
              <div class="sheet-data-area sheet-fokus">
                <input name="attr_fokus_v" type="hidden" value="0"/>
                <input name="attr_fokus_e" type="hidden" value="0"/>
                <input name="attr_fokus_k" type="hidden" value="0"/>
                <input name="attr_fokus_t" type="hidden" value="0"/>
                <input name="attr_sr1" type="hidden" value="1"/>
                <input name="attr_sr2" type="hidden" value="1"/><span class="sheet-verzehrt" name="attr_fokus_v_bar"></span><span class="sheet-erschoepft" name="attr_fokus_e_bar"></span><span class="sheet-kanalisiert" name="attr_fokus_k_bar"></span><span class="sheet-lebenspunkte-t" name="attr_fokus_t_bar"></span>
              </div>
            </div>
          </div>
          <div class="sheet-data-section-row">
            <div class="sheet-data-section-schaden">
              <div class="sheet-data-header">
                <h3>Schaden</h3>
              </div>
              <div class="sheet-data-area">
                <button name="act_removeschaden" type="action">heilen</button>
                <input name="attr_anzahlschaden" type="number" value=""/>
                <select name="attr_anzahlschadenart">
                  <option value="v">verzehrt</option>
                  <option value="e">erschÃ¶pft</option>
                  <option value="k">kanalisiert</option>
                </select>
                <button name="act_addschaden" type="action">zufÃ¼gen</button>
              </div>
            </div>
            <div class="sheet-data-section-regeneration">
              <div class="sheet-data-header">
                <h3>Regeneration</h3>
              </div>
              <div class="sheet-data-area">
                <label>Bonus</label>
                <input name="attr_regbonus" type="number" value="0"/>
                <button name="act_ruhephase" type="action">Ruhephase</button>
                <button name="act_verschnaufpause" type="action">Verschnaufpause</button>
              </div>
            </div>
            <div class="sheet-data-section-aktiveabwehr">
              <div class="sheet-data-header">
                <h3>Aktive Abwehr</h3>
              </div>
              <div class="sheet-data-area">
                <button type="roll"></button>
                <label><span>Akrobatik</span></label><span name="attr_akrobatik"></span>
              </div>
              <fieldset class="repeating_aawaffen">
                <div class="sheet-data-area">
                  <button type="roll"></button>
                  <label><span name="attr_aawaffe"></span></label><span name="attr_aawert"></span>
                </div>
              </fieldset>
            </div>
          </div>
          <div class="sheet-data-section-waffen">
            <div class="sheet-data-header">
              <h3>Waffen</h3><span>Wert</span><span>Mod</span><span>Schaden</span><span>WGS</span><span>RW</span><span style="text-align:left">Merkmale</span>
            </div>
            <fieldset class="repeating_waffen">
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{waffenskill} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=@{waffenname}}}"></button>
                <button class="sheet-play-only" type="action" name="act_rollweapon"></button><span>
                  <input name="attr_waffenname" type="text" value="" placeholder="Waffenname"/><span style="white-space: nowrap">
                    <select name="attr_waffenskill"> 
                      <option value="handgemenge">Handgemenge</option>
                      <option value="hiebwaffen">Hiebwaffen</option>
                      <option value="kettenwaffen">Kettenwaffen</option>
                      <option value="klingenwaffen">Klingenwaffen</option>
                      <option value="stangenwaffen">Stangenwaffen</option>
                      <option value="schusswaffen">Schusswaffen</option>
                      <option value="wurfwaffen">Wurfwaffen</option>
                    </select>+
                    <select name="attr_waffenattr1"> 
                      <option value="ausstrahlung">AUS</option>
                      <option value="beweglichkeit">BEW</option>
                      <option value="intuition">INT</option>
                      <option value="konstitution">KON</option>
                      <option value="mystik">MYS</option>
                      <option value="staerke">STÃ„</option>
                      <option value="verstand">VER</option>
                      <option value="willenskraft">WIL</option>
                    </select>+
                    <select name="attr_waffenattr2"> 
                      <option value="ausstrahlung">AUS</option>
                      <option value="beweglichkeit">BEW</option>
                      <option value="intuition">INT</option>
                      <option value="konstitution">KON</option>
                      <option value="mystik">MYS</option>
                      <option value="staerke">STÃ„</option>
                      <option value="verstand">VER</option>
                      <option value="willenskraft">WIL</option>
                    </select></span></span><span class="sheet-main-value" name="attr_waffenwert"></span>
                <input name="attr_waffenmoduser" type="number" value="0"/>
                <input name="attr_waffenschaden" type="text" value="W6"/>
                <input name="attr_waffenwgs" type="number" value="3"/>
                <input name="attr_waffenreichweite" type="number" value="0"/><span><span class="sheet-autoexpand sheet-small" placeholder="-">
                    <input class="sheet-small" name="attr_waffenmerkmale" type="text" value="" placeholder="-"/><span class="sheet-autoexpand sheet-small" name="attr_waffenmerkmale" placeholder="-"></span></span>
                  <input name="attr_waffennotizen" type="text" value="" placeholder="Notizen"/></span>
              </div>
            </fieldset>
          </div>
          <div class="sheet-data-section-zauber">
            <div class="sheet-data-header">
              <h3>Zauber</h3><span>Wert</span><span>Mod</span><span>SG</span><span>Schaden</span><span>Kosten (verstÃ¤rkt)</span><span>ZD</span><span>RW</span><span>WD</span>
            </div>
            <fieldset class="repeating_zauber">
              <div class="sheet-data-area">
                <button class="sheet-play-only" type="roll" value="@{probensichtbarkeit} &amp;{template:default} {{erfolgsgrad_triumph=[[[[[[floor(abs([[[[@{probenwurfoption} + @{zauberwert} + @{probenmodifikator}]]  - @{probenschwierigkeit}]])/3)]] -3]] + 6]]}} {{wurf1=$[[0]]}} {{wurf2=$[[1]]}} {{wurf3=$[[2]]}} {{wurf4=$[[3]]}} {{gesamtwurf=$[[4]]}} {{gesamtprobe=$[[5]]}} {{gesamtprobendifferenz=$[[6]]}} {{erfolgsgrad=$[[7]]}} {{erfolgsgrad_patzer=$[[8]]}} {{titel=@{zaubername}}}"></button>
                <label class="sheet-show-more" style="z-index:1999">
                  <input name="attr_zaubershowmore" type="checkbox" value="on"/><span>4</span>
                </label><span>
                  <input name="attr_zaubername" type="text" value="" placeholder="Zaubername"/>
                  <select name="attr_magieschulen"> 
                    <option value="bannmagie">Bannmagie</option>
                    <option value="beherrschungsmagie">Beherrschungsmagie</option>
                    <option value="bewegungsmagie">Bewegungsmagie</option>
                    <option value="erkenntnismagie">Erkenntnismagie</option>
                    <option value="felsmagie">Fellsmagie</option>
                    <option value="feuermagie">Feuermagie</option>
                    <option value="heilungsmagie">Heilungsmagie</option>
                    <option value="illusionsmagie">Illusionsmagie</option>
                    <option value="kampfmagie">Kampfmagie</option>
                    <option value="lichtmagie">Lichtmagie</option>
                    <option value="naturmagie">Naturmagie</option>
                    <option value="schattenmagie">Schattenmagie</option>
                    <option value="schicksalsmagie">Schicksalsmagie</option>
                    <option value="schutzmagie">Schutzmagie</option>
                    <option value="staerkungsmagie">StÃ¤rkungsmagie</option>
                    <option value="todesmagie">Todesmagie</option>
                    <option value="verwandlungsmagie">Verwandlungsmagie</option>
                    <option value="wassermagie">Wassermagie</option>
                    <option value="windmagie">Windmagie</option>
                  </select></span><span class="sheet-main-value" name="attr_zauberwert"></span>
                <input name="attr_zaubermoduser" type="number" value="0"/>
                <input name="attr_zauberschwierigkeit" type="text" value="" placeholder="SG"/><span class="sheet-autoexpand" placeholder="Schaden">
                  <input name="attr_zauberschaden" type="text" value="" placeholder="Schaden"/><span class="sheet-autoexpand" name="attr_zauberschaden" placeholder="Schaden"></span></span><span class="sheet-autoexpand" placeholder="Kosten">
                  <input name="attr_zauberkosten" type="text" value="" placeholder="Kosten"/><span class="sheet-autoexpand" name="attr_zauberkosten" placeholder="Kosten"></span></span><span class="sheet-autoexpand" placeholder="ZD">
                  <input name="attr_zauberdauer" type="text" value="" placeholder="ZD"/><span class="sheet-autoexpand" name="attr_zauberdauer" placeholder="ZD"></span></span><span class="sheet-autoexpand" placeholder="RW">
                  <input name="attr_zauberrw" type="text" value="" placeholder="RW"/><span class="sheet-autoexpand" name="attr_zauberrw" placeholder="RW"></span></span><span class="sheet-autoexpand" placeholder="WD">
                  <input name="attr_zauberwd" type="text" value="" placeholder="WD"/><span class="sheet-autoexpand" name="attr_zauberwd" placeholder="WD"></span></span>
                <input name="attr_zaubershowmore" type="hidden" value=""/>
                <textarea class="sheet-small" name="attr_zauberwirkung" placeholder="Zauberwirkung" rows="4"></textarea>
              </div>
            </fieldset>
          </div>
          <div class="sheet-data-section-ruestungen">
            <input name="attr_ruestungmod" type="hidden" value=""/>
            <div class="sheet-data-header">
              <h3>RÃ¼stung</h3><span></span><span>VTD+</span><span>SR</span><span>BE</span><span>Tick+</span><span>Merkmale</span>
            </div>
            <div class="sheet-data-area">
              <input name="attr_ruestungsvtdmod" type="hidden" value="0"/>
              <input name="attr_ruestungssrmod" type="hidden" value="0"/>
              <input name="attr_ruestungsbemod" type="hidden" value="0"/>
              <input name="attr_ruestungstickplusmod" type="hidden" value="0"/>
              <fieldset class="repeating_ruestungen">
                <input name="attr_ruestungonoff" type="checkbox" value="1"/>
                <input name="attr_ruestungsname" type="text" value="" placeholder="RÃ¼stungsname"/>
                <input name="attr_ruestungsvtd" type="number" value="0"/>
                <input name="attr_ruestungssr" type="number" value="0"/>
                <input name="attr_ruestungsbe" type="number" value="0"/>
                <input name="attr_ruestungstickplus" type="number" value="0"/>
                <input name="attr_ruestungsmerkmal" type="text" value="" placeholder="-"/>
              </fieldset>
            </div>
          </div>
          <div class="sheet-data-section-schilde">
            <div class="sheet-data-header">
              <h3>Schild</h3><span></span><span>VTD+</span><span>SR</span><span>BE</span><span>Tick+</span><span>Merkmale</span>
            </div>
            <div class="sheet-data-area">
              <input name="attr_schildvtdmod" type="hidden" value="0"/>
              <input name="attr_schildsrmod" type="hidden" value="0"/>
              <input name="attr_schildbemod" type="hidden" value="0"/>
              <input name="attr_schildtickplusmod" type="hidden" value="0"/>
              <div> 
                <div>
                  <input name="attr_schildonoff" type="checkbox" value="1"/>
                  <input name="attr_schildname" type="text" value="" placeholder="Schildname"/>
                  <input name="attr_schildvtd" type="number" value="0"/>
                  <input name="attr_schildsr" type="number" value="0"/>
                  <input name="attr_schildbe" type="number" value="0"/>
                  <input name="attr_schildtickplus" type="number" value="0"/>
                  <input name="attr_schildmerkmale" type="text" value="" placeholder="-"/>
                </div>
              </div>
            </div>
            <div class="sheet-data-area">
              <div> 
                <div><span></span>
                  <label>Gesamt:</label><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_ruestungvtd"></span><span class="sheet-tooltiptext"> <span class="sheet-pre" name="attr_ruestungvtdmodtooltip"></span></span></span><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_ruestungsr"></span><span class="sheet-tooltiptext"> <span class="sheet-pre" name="attr_ruestungsrmodtooltip"></span></span></span><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_ruestungbe"></span><span class="sheet-tooltiptext"> <span class="sheet-pre" name="attr_ruestungbemodtooltip"></span></span></span><span class="sheet-tooltip"><span class="sheet-main-value" name="attr_ruestungtickplus"></span><span class="sheet-tooltiptext"><span class="sheet-pre" name="attr_ruestungtickplusmodtooltip"></span></span></span>
                </div>
              </div>
            </div>
          </div>
          <div class="sheet-data-section-meisterschaften">
            <div class="sheet-data-header">
              <h3>Meisterschaften</h3><span>Fertigkeit</span><span>Schwelle</span><span>Beschreibung</span>
            </div>
            <div class="sheet-data-area">
              <input name="attr_meisterschaftmod" type="hidden" value=""/>
              <fieldset class="repeating_meisterschaften">
                <input name="attr_meisterschaftsname" type="text" value="" placeholder="Meisterschaft"/>
                <select name="attr_magieschulen">
                  <optgroup label="Allgemeine Fertigkeiten">
                    <option value="akrobatik">Akrobatik</option>
                    <option value="alchemie">Alchemie</option>
                    <option value="anfuehren">AnfÃ¼hren</option>
                    <option value="arkanekunde">Arkane Kunde</option>
                    <option value="athletik">Athletik</option>
                    <option value="darbietung">Darbietung</option>
                    <option value="diplomatie">Diplomatie</option>
                    <option value="edelhandwerk">Edelhandwerk</option>
                    <option value="empathie">Empathie</option>
                    <option value="entschlossenheit">Entschlossenheit</option>
                    <option value="fingerfertigkeit">Fingerfertigkeit</option>
                    <option value="geschichtenundmythen">Geschichten &amp; Mythen</option>
                    <option value="handwerk">Handwerk</option>
                    <option value="heilkunde">Heilkunde</option>
                    <option value="heimlichkeit">Heimlichkeit</option>
                    <option value="jagdkunst">Jagdkunst</option>
                    <option value="laenderkunde">LÃ¤nderkunde</option>
                    <option value="naturkunde">Naturkunde</option>
                    <option value="redegewandtheit">Redegewandtheit</option>
                    <option value="schloesserundfallen">SchlÃ¶sser &amp; Fallen</option>
                    <option value="schwimmen">Schwimmen</option>
                    <option value="seefahrt">Seefahrt</option>
                    <option value="strassenkunde">StraÃŸenkunde</option>
                    <option value="tierfuehrung">Tierfuehrung</option>
                    <option value="ueberleben">Ãœberleben</option>
                    <option value="wahrnehmung">Wahrnehmung</option>
                    <option value="zaehigkeit">ZÃ¤higkeit</option>
                  </optgroup>
                  <optgroup label="Magieschulen">
                    <option value="bannmagie">Bannmagie</option>
                    <option value="beherrschungsmagie">Beherrschungsmagie</option>
                    <option value="bewegungsmagie">Bewegungsmagie</option>
                    <option value="erkenntnismagie">Erkenntnismagie</option>
                    <option value="felsmagie">Fellsmagie</option>
                    <option value="feuermagie">Feuermagie</option>
                    <option value="heilungsmagie">Heilungsmagie</option>
                    <option value="illusionsmagie">Illusionsmagie</option>
                    <option value="kampfmagie">Kampfmagie</option>
                    <option value="lichtmagie">Lichtmagie</option>
                    <option value="naturmagie">Naturmagie</option>
                    <option value="schattenmagie">Schattenmagie</option>
                    <option value="schicksalsmagie">Schicksalsmagie</option>
                    <option value="schutzmagie">Schutzmagie</option>
                    <option value="staerkungsmagie">StÃ¤rkungsmagie</option>
                    <option value="todesmagie">Todesmagie</option>
                    <option value="verwandlungsmagie">Verwandlungsmagie</option>
                    <option value="wassermagie">Wassermagie</option>
                    <option value="windmagie">Windmagie</option>
                  </optgroup>
                  <optgroup label="Kampffertigkeiten">
                    <option value="handgemenge">Handgemenge</option>
                    <option value="hiebwaffen">Hiebwaffen</option>
                    <option value="kettenwaffen">Kettenwaffen</option>
                    <option value="klingenwaffen">Klingenwaffen</option>
                    <option value="stangenwaffen">Stangenwaffen</option>
                    <option value="schusswaffen">Schusswaffen</option>
                    <option value="wurfwaffen">Wurfwaffen</option>
                  </optgroup>
                </select>
                <input name="attr_meisterschaftsschwelle" type="number" value="0"/><span class="sheet-autoexpand" placeholder="Beschreibung">
                  <input name="attr_meisterschaftswirkung" type="text" value="" placeholder="Beschreibung"/><span class="sheet-autoexpand" name="attr_meisterschaftswirkung" placeholder="Beschreibung"></span></span>
              </fieldset>
            </div>
          </div>
        </div>
        <div class="sheet-tab-content sheet-ausruestung"> 
          <div class="sheet-data-section-geld">
            <div class="sheet-data-header">
              <h3>Geld</h3>
            </div>
            <div class="sheet-data-area">
              <label>Solare</label>
              <input class="sheet-main-value" name="attr_solare" type="number" value="0"/>
              <label>Lunare</label>
              <input name="attr_lunare" type="number" value="0"/>
              <label>Telare</label>
              <input name="attr_telare" type="number" value="0"/>
            </div>
          </div>
          <div class="sheet-data-section-ausruestung">
            <h3><span> </span><span>Am KÃ¶rper</span></h3>
            <div class="sheet-data-header"><span>Getr.</span><span>Anzahl</span><span>Name</span><span>Last</span><span>HÃ¤rte</span><span>Zustand</span><span>Info</span></div>
            <fieldset class="repeating_ausruestung">
              <div class="sheet-data-area">
                <input name="attr_getragen" type="checkbox" value="1" checked="checked"/>
                <input name="attr_anzahl" type="number" value="1"/>
                <input name="attr_name" type="text" value="" placeholder="Name des Gegenstands"/>
                <input name="attr_last" type="number" value="0"/>
                <input name="attr_haerte" type="number" value="0"/>
                <select name="attr_zustand"> 
                  <option value="benommen">UnbeschÃ¤digt</option>
                  <option value="bewusstlos">Angeschlagen (-3)</option>
                  <option value="erschoepft">Demoliert</option>
                </select>
                <input name="attr_info" type="text" value="" placeholder="Infos zur AusrÃ¼stung"/>
              </div>
            </fieldset>
            <div class="sheet-data-area"><span></span><span></span>
              <label>Gesamtlast</label><span name="attr_gesamtlast_koerper"></span>
            </div>
          </div>
          <input name="attr_behaelter1" type="hidden" value=""/>
          <div class="sheet-data-section-ausruestung">
            <h3><span> 
                <input class="sheet-edit-only" name="attr_behaelter1" type="checkbox" value="1"/></span>
              <input name="attr_behaelter1_name" type="text" value="" placeholder="Name des BehÃ¤lters"/>
            </h3>
            <input name="attr_behaelter1" type="hidden" value=""/>
            <div class="sheet-data-header"><span>Getr.</span><span>Anzahl</span><span>Name</span><span>Last</span><span>HÃ¤rte</span><span>Zustand</span><span>Info</span></div>
            <fieldset class="repeating_behaelter1">
              <div class="sheet-data-area">
                <input name="attr_getragen" type="checkbox" value="1"/>
                <input name="attr_anzahl" type="number" value="1"/>
                <input name="attr_name" type="text" value="" placeholder="Name des Gegenstands"/>
                <input name="attr_last" type="number" value="0"/>
                <input name="attr_haerte" type="number" value="0"/>
                <select name="attr_zustand"> 
                  <option value="benommen">UnbeschÃ¤digt</option>
                  <option value="bewusstlos">Angeschlagen (-3)</option>
                  <option value="erschoepft">Demoliert</option>
                </select>
                <input name="attr_info" type="text" value="" placeholder="Infos zur AusrÃ¼stung"/>
              </div>
            </fieldset>
            <div class="sheet-data-area"><span></span><span></span>
              <label>Gesamtlast</label><span name="attr_gesamtlast_behaelter1"></span>
            </div>
          </div>
          <input name="attr_behaelter2" type="hidden" value=""/>
          <div class="sheet-data-section-ausruestung">
            <h3><span> 
                <input class="sheet-edit-only" name="attr_behaelter2" type="checkbox" value="1"/></span>
              <input name="attr_behaelter2_name" type="text" value="" placeholder="Name des BehÃ¤lters"/>
            </h3>
            <input name="attr_behaelter2" type="hidden" value=""/>
            <div class="sheet-data-header"><span>Getr.</span><span>Anzahl</span><span>Name</span><span>Last</span><span>HÃ¤rte</span><span>Zustand</span><span>Info</span></div>
            <fieldset class="repeating_behaelter2">
              <div class="sheet-data-area">
                <input name="attr_getragen" type="checkbox" value="1"/>
                <input name="attr_anzahl" type="number" value="1"/>
                <input name="attr_name" type="text" value="" placeholder="Name des Gegenstands"/>
                <input name="attr_last" type="number" value="0"/>
                <input name="attr_haerte" type="number" value="0"/>
                <select name="attr_zustand"> 
                  <option value="benommen">UnbeschÃ¤digt</option>
                  <option value="bewusstlos">Angeschlagen (-3)</option>
                  <option value="erschoepft">Demoliert</option>
                </select>
                <input name="attr_info" type="text" value="" placeholder="Infos zur AusrÃ¼stung"/>
              </div>
            </fieldset>
            <div class="sheet-data-area"><span></span><span></span>
              <label>Gesamtlast</label><span name="attr_gesamtlast_behaelter2"></span>
            </div>
          </div>
          <input name="attr_behaelter3" type="hidden" value=""/>
          <div class="sheet-data-section-ausruestung">
            <h3><span> 
                <input class="sheet-edit-only" name="attr_behaelter3" type="checkbox" value="1"/></span>
              <input name="attr_behaelter3_name" type="text" value="" placeholder="Name des BehÃ¤lters"/>
            </h3>
            <input name="attr_behaelter3" type="hidden" value=""/>
            <div class="sheet-data-header"><span>Getr.</span><span>Anzahl</span><span>Name</span><span>Last</span><span>HÃ¤rte</span><span>Zustand</span><span>Info</span></div>
            <fieldset class="repeating_behaelter3">
              <div class="sheet-data-area">
                <input name="attr_getragen" type="checkbox" value="1"/>
                <input name="attr_anzahl" type="number" value="1"/>
                <input name="attr_name" type="text" value="" placeholder="Name des Gegenstands"/>
                <input name="attr_last" type="number" value="0"/>
                <input name="attr_haerte" type="number" value="0"/>
                <select name="attr_zustand"> 
                  <option value="benommen">UnbeschÃ¤digt</option>
                  <option value="bewusstlos">Angeschlagen (-3)</option>
                  <option value="erschoepft">Demoliert</option>
                </select>
                <input name="attr_info" type="text" value="" placeholder="Infos zur AusrÃ¼stung"/>
              </div>
            </fieldset>
            <div class="sheet-data-area"><span></span><span></span>
              <label>Gesamtlast</label><span name="attr_gesamtlast_behaelter3"></span>
            </div>
          </div>
          <input name="attr_behaelter4" type="hidden" value=""/>
          <div class="sheet-data-section-ausruestung">
            <h3><span> 
                <input class="sheet-edit-only" name="attr_behaelter4" type="checkbox" value="1"/></span>
              <input name="attr_behaelter4_name" type="text" value="" placeholder="Name des BehÃ¤lters"/>
            </h3>
            <input name="attr_behaelter4" type="hidden" value=""/>
            <div class="sheet-data-header"><span>Getr.</span><span>Anzahl</span><span>Name</span><span>Last</span><span>HÃ¤rte</span><span>Zustand</span><span>Info</span></div>
            <fieldset class="repeating_behaelter4">
              <div class="sheet-data-area">
                <input name="attr_getragen" type="checkbox" value="1"/>
                <input name="attr_anzahl" type="number" value="1"/>
                <input name="attr_name" type="text" value="" placeholder="Name des Gegenstands"/>
                <input name="attr_last" type="number" value="0"/>
                <input name="attr_haerte" type="number" value="0"/>
                <select name="attr_zustand"> 
                  <option value="benommen">UnbeschÃ¤digt</option>
                  <option value="bewusstlos">Angeschlagen (-3)</option>
                  <option value="erschoepft">Demoliert</option>
                </select>
                <input name="attr_info" type="text" value="" placeholder="Infos zur AusrÃ¼stung"/>
              </div>
            </fieldset>
            <div class="sheet-data-area"><span></span><span></span>
              <label>Gesamtlast</label><span name="attr_gesamtlast_behaelter4"></span>
            </div>
          </div>
          <input name="attr_behaelter5" type="hidden" value=""/>
          <div class="sheet-data-section-ausruestung">
            <h3><span> 
                <input class="sheet-edit-only" name="attr_behaelter5" type="checkbox" value="1"/></span>
              <input name="attr_behaelter5_name" type="text" value="" placeholder="Name des BehÃ¤lters"/>
            </h3>
            <input name="attr_behaelter5" type="hidden" value=""/>
            <div class="sheet-data-header"><span>Getr.</span><span>Anzahl</span><span>Name</span><span>Last</span><span>HÃ¤rte</span><span>Zustand</span><span>Info</span></div>
            <fieldset class="repeating_behaelter5">
              <div class="sheet-data-area">
                <input name="attr_getragen" type="checkbox" value="1"/>
                <input name="attr_anzahl" type="number" value="1"/>
                <input name="attr_name" type="text" value="" placeholder="Name des Gegenstands"/>
                <input name="attr_last" type="number" value="0"/>
                <input name="attr_haerte" type="number" value="0"/>
                <select name="attr_zustand"> 
                  <option value="benommen">UnbeschÃ¤digt</option>
                  <option value="bewusstlos">Angeschlagen (-3)</option>
                  <option value="erschoepft">Demoliert</option>
                </select>
                <input name="attr_info" type="text" value="" placeholder="Infos zur AusrÃ¼stung"/>
              </div>
            </fieldset>
            <div class="sheet-data-area"><span></span><span></span>
              <label>Gesamtlast</label><span name="attr_gesamtlast_behaelter5"></span>
            </div>
          </div>
          <div class="sheet-data-section-notizen">
            <div class="sheet-data-header">
              <h3>Notizen</h3>
            </div>
            <div class="sheet-data-area">
              <textarea name="attr_notizen"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/worker">var splittermond = {"rassen":{"mensch":{"name":"Mensch","groessenklasse":5},"varg":{"name":"Varg","groessenklasse":6},"alb":{"name":"Alb","groessenklasse":5},"gnom":{"name":"Gnom","groessenklasse":3},"zwerg":{"name":"Zwerg","groessenklasse":4}},"abgeleiteteWerte":{"groessenklasse":{"long":"GrÃ¶ÃŸenklasse","short":"GK"},"geschwindigkeit":{"long":"Geschwindigkeit","short":"GSW"},"initiative":{"long":"Initiative","short":"INI"},"lebenspunkte":{"long":"Lebenspunkte","short":"LP"},"fokus":{"long":"Fokus","short":"FO"},"verteidigung":{"long":"Verteidigung","short":"VTD"},"geistigerwiderstand":{"long":"Geistiger Widerstand","short":"GW"},"koerperlicherwiderstand":{"long":"KÃ¶rperlicher Widerstand","short":"KW"}},"attribute":{"ausstrahlung":{"long":"Ausstrahlung","short":"AUS"},"beweglichkeit":{"long":"Beweglichkeit","short":"BEW"},"intuition":{"long":"Intuition","short":"INT"},"konstitution":{"long":"Konstitution","short":"KON"},"mystik":{"long":"Mystik","short":"MYS"},"staerke":{"long":"StÃ¤rke","short":"STÃ„"},"verstand":{"long":"Verstand","short":"VER"},"willenskraft":{"long":"Willenskraft","short":"WIL"}},"fertigkeiten":{"akrobatik":{"Name":"Akrobatik","Attribute":["Beweglichkeit","Staerke"]},"alchemie":{"Name":"Alchemie","Attribute":["Mystik","Verstand"]},"anfuehren":{"Name":"AnfÃ¼hren","Attribute":["Ausstrahlung","Willenskraft"]},"arkanekunde":{"Name":"Arkane Kunde","Attribute":["Mystik","Verstand"]},"athletik":{"Name":"Athletik","Attribute":["Beweglichkeit","Staerke"]},"darbietung":{"Name":"Darbietung","Attribute":["Ausstrahlung","Willenskraft"]},"diplomatie":{"Name":"Diplomatie","Attribute":["Ausstrahlung","Verstand"]},"edelhandwerk":{"Name":"Edelhandwerk","Attribute":["Intuition","Verstand"]},"empathie":{"Name":"Empathie","Attribute":["Intuition","Verstand"]},"entschlossenheit":{"Name":"Entschlossenheit","Attribute":["Ausstrahlung","Willenskraft"]},"fingerfertigkeit":{"Name":"Fingerfertigkeit","Attribute":["Ausstrahlung","Beweglichkeit"]},"geschichtenundmythen":{"Name":"Geschichten & Mythen","Attribute":["Mystik","Verstand"]},"handwerk":{"Name":"Handwerk","Attribute":["Konstitution","Verstand"]},"heilkunde":{"Name":"Heilkunde","Attribute":["Intuition","Verstand"]},"heimlichkeit":{"Name":"Heimlichkeit","Attribute":["Beweglichkeit","Intuition"]},"jagdkunst":{"Name":"Jagdkunst","Attribute":["Konstitution","Verstand"]},"laenderkunde":{"Name":"LÃ¤nderkunde","Attribute":["Intuition","Verstand"]},"naturkunde":{"Name":"Naturkunde","Attribute":["Intuition","Verstand"]},"redegewandtheit":{"Name":"Redegewandtheit","Attribute":["Ausstrahlung","Willenskraft"]},"schloesserundfallen":{"Name":"SchlÃ¶sser & Fallen","Attribute":["Intuition","Beweglichkeit"]},"schwimmen":{"Name":"Schwimmen","Attribute":["Konstitution","Staerke"]},"seefahrt":{"Name":"Seefahrt","Attribute":["Beweglichkeit","Konstitution"]},"strassenkunde":{"Name":"StraÃŸenkunde","Attribute":["Ausstrahlung","Intuition"]},"tierfuehrung":{"Name":"Tierfuehrung","Attribute":["Ausstrahlung","Beweglichkeit"]},"ueberleben":{"Name":"Ãœberleben","Attribute":["Intuition","Konstitution"]},"wahrnehmung":{"Name":"Wahrnehmung","Attribute":["Intuition","Willenskraft"]},"zaehigkeit":{"Name":"ZÃ¤higkeit","Attribute":["Konstitution","Willenskraft"]}},"kampffertigkeiten":{"handgemenge":{"Name":"Handgemenge"},"hiebwaffen":{"Name":"Hiebwaffen"},"kettenwaffen":{"Name":"Kettenwaffen"},"klingenwaffen":{"Name":"Klingenwaffen"},"stangenwaffen":{"Name":"Stangenwaffen"},"schusswaffen":{"Name":"Schusswaffen"},"wurfwaffen":{"Name":"Wurfwaffen"}},"magieschulen":{"bannmagie":{"Name":"Bannmagie","Attribute":["Mystik","Willenskraft"]},"beherrschungsmagie":{"Name":"Beherrschungsmagie","Attribute":["Mystik","Willenskraft"]},"bewegungsmagie":{"Name":"Bewegungsmagie","Attribute":["Mystik","Beweglichkeit"]},"erkenntnismagie":{"Name":"Erkenntnismagie","Attribute":["Mystik","Verstand"]},"felsmagie":{"Name":"Fellsmagie","Attribute":["Mystik","Konstitution"]},"feuermagie":{"Name":"Feuermagie","Attribute":["Mystik","Ausstrahlung"]},"heilungsmagie":{"Name":"Heilungsmagie","Attribute":["Mystik","Ausstrahlung"]},"illusionsmagie":{"Name":"Illusionsmagie","Attribute":["Mystik","Ausstrahlung"]},"kampfmagie":{"Name":"Kampfmagie","Attribute":["Mystik","Staerke"]},"lichtmagie":{"Name":"Lichtmagie","Attribute":["Mystik","Ausstrahlung"]},"naturmagie":{"Name":"Naturmagie","Attribute":["Mystik","Ausstrahlung"]},"schattenmagie":{"Name":"Schattenmagie","Attribute":["Mystik","Intuition"]},"schicksalsmagie":{"Name":"Schicksalsmagie","Attribute":["Mystik","Ausstrahlung"]},"schutzmagie":{"Name":"Schutzmagie","Attribute":["Mystik","Ausstrahlung"]},"staerkungsmagie":{"Name":"StÃ¤rkungsmagie","Attribute":["Mystik","Staerke"]},"todesmagie":{"Name":"Todesmagie","Attribute":["Mystik","Verstand"]},"verwandlungsmagie":{"Name":"Verwandlungsmagie","Attribute":["Mystik","Konstitution"]},"wassermagie":{"Name":"Wassermagie","Attribute":["Mystik","Intuition"]},"windmagie":{"Name":"Windmagie","Attribute":["Mystik","Verstand"]}},"staerken":{"natÃ¼rlicher rÃ¼stungsschutz":{"tooltip":"nat. RÃ¼stung","modifier":{"schadensreduktion":1}},"erhÃ¶hter fokuspool":{"tooltip":"erhÃ¶hter FO","modifier":{"fokus":5}},"flink":{"tooltip":"Flink","modifier":{"geschwindigkeit":1}},"robust":{"tooltip":"Robust","modifier":{"lebenspunkte":1}},"hoher kÃ¶rperlicher widerstand":{"tooltip":"Hoher KW","modifier":{"koerperlicherwiderstand":2}},"hoher geistiger widerstand":{"tooltip":"Hoher GW","modifier":{"geistigerwiderstand":2}},"verbesserte initiative":{"tooltip":"Verb. INI","modifier":{"initiative":-3}},"schmerzresistenz":{"tooltip":"Schmerzres.","modifier":{"wundabzug":-2}},"zusÃ¤tzliche splitterpunkte":{"tooltip":"Zus. Splitterp.","modifier":{"splitterpunkt":2}},"erhÃ¶hte fokusregeneration":{"tooltip":"Hohe FO-Reg.","modifier":{"fokusreg":2}},"erhÃ¶hte lebensregeneration":{"tooltip":"Hohe LP-Reg.","modifier":{"lifereg":2}}},"zustaende":{"verwundet":{"tooltip":"verwundet","modifier":{"gesundheitsstufe":1}},"benommen":{"tooltip":"benommen","modifier":{"tickplus":1}},"erschÃ¶pft":{"tooltip":"erschÃ¶pft","modifier":{"akrobatik":-1,"alchemie":-1,"anfuehren":-1,"arkanekunde":-1,"athletik":-1,"darbietung":-1,"diplomatie":-1,"edelhandwerk":-1,"empathie":-1,"entschlossenheit":-1,"fingerfertigkeit":-1,"geschichtenundmythen":-1,"handwerk":-1,"heilkunde":-1,"heimlichkeit":-1,"jagdkunst":-1,"laenderkunde":-1,"naturkunde":-1,"redegewandtheit":-1,"schloesserundfallen":-1,"schwimmen":-1,"seefahrt":-1,"strassenkunde":-1,"tierfuehrung":-1,"ueberleben":-1,"wahrnehmung":-1,"zaehigkeit":-1,"handgemenge":-1,"hiebwaffen":-1,"kettenwaffen":-1,"klingenwaffen":-1,"stangenwaffen":-1,"schusswaffen":-1,"wurfwaffen":-1,"initiative":1,"geschwindigkeit":-1}},"lahm":{"tooltip":"lahm","modifier":{},"multiplier":{"geschwindigkeit":0.5}},"glaubenskrise":{"tooltip":"Glaubenskrise","modifier":{"bannmagie":-1,"beherrschungsmagie":-1,"bewegungsmagie":-1,"erkenntnismagie":-1,"felsmagie":-1,"feuermagie":-1,"heilungsmagie":-1,"illusionsmagie":-1,"kampfmagie":-1,"lichtmagie":-1,"naturmagie":-1,"schattenmagie":-1,"schicksalsmagie":-1,"schutzmagie":-1,"staerkungsmagie":-1,"todesmagie":-1,"verwandlungsmagie":-1,"wassermagie":-1,"windmagie":-1}}},"meisterschaften":{"blitzreflexe":{"tooltip":"Blitzreflexe","modifier":{"initiative":3}},"gute reflexe":{"tooltip":"Gute Reflexe","modifier":{"verteidigung":1}},"rÃ¼stungstrÃ¤ger i":{"tooltip":"RÃ¼stungstrÃ¤ger I","modifier":{"ruestungsbe":-1}},"rÃ¼stungstrÃ¤ger 1":{"tooltip":"RÃ¼stungstrÃ¤ger I","modifier":{"ruestungsbe":-1}},"rÃ¼stungstrÃ¤ger ii":{"tooltip":"RÃ¼stungstrÃ¤ger II","modifier":{"ruestungstickplus":-1}},"rÃ¼stungstrÃ¤ger 2":{"tooltip":"RÃ¼stungstrÃ¤ger II","modifier":{"ruestungstickplus":-1}},"starker schildarm i":{"tooltip":"Starker Schildarm I","modifier":{"schildbe":-1}},"starker schildarm 1":{"tooltip":"Starker Schildarm I","modifier":{"schildbe":-1}},"starker schildarm ii":{"tooltip":"Starker Schildarm II","modifier":{"schildtickplus":-1}},"starker schildarm 2":{"tooltip":"Starker Schildarm II","modifier":{"schildtickplus":-1}},"schmerzwiderstand i":{"tooltip":"Schmerzwiderstand I","modifier":{"wundabzug":-1}},"schmerzwiderstand 1":{"tooltip":"Schmerzwiderstand I","modifier":{"wundabzug":-1}},"schmerzwiderstand ii":{"tooltip":"Schmerzwiderstand II","modifier":{"wundabzug":-1}},"schmerzwiderstand 2":{"tooltip":"Schmerzwiderstand II","modifier":{"wundabzug":-1}},"arkane geschwindigkeit":{"tooltip":"Arkane Geschwindigkeit","modifier":{"geschwindigkeit":1}},"sprinter":{"tooltip":"Sprinter","modifier":{"geschwindigkeit":1}}}};["einstellungen", "grundwerte", "fertigkeiten", "magie", "ausruestung", "kampf"].forEach(button => {
    on(`clicked:${button}`, function () {
        setAttrs({
            tab: button
        });
    });
});

on("clicked:incschwierigkeit", function () {
    getAttrs(["probenschwierigkeit"], v => {
        setAttrs({
            "probenschwierigkeit": int(v.probenschwierigkeit) + 1
        });
    });
});

on("clicked:decschwierigkeit", function () {
    getAttrs(["probenschwierigkeit"], v => {
        setAttrs({
            "probenschwierigkeit": int(v.probenschwierigkeit) - 1
        });
    });
});

on("clicked:incmod", function () {
    getAttrs(["probenmodifikator"], v => {
        setAttrs({
            "probenmodifikator": int(v.probenmodifikator) + 1
        })
    })
});

on("clicked:decmod", function () {
    getAttrs(["probenmodifikator"], v => {
        setAttrs({
            "probenmodifikator": int(v.probenmodifikator) - 1
        });
    });
});
  function autoUpdate(attributes, dataCallback) {
    attributesStr = attributes.map(attr => "change:" + attr).join(" ");
    on(attributesStr, e => getAttrs(attributes, v => setAttrs(dataCallback(v, e))));
}

var allModifier = [];

function int(value, defaultValue = 0) {
    return parseInt(value) || defaultValue;
}

function modStr(value, defaultValue = 0) {
    var val = int(value);
    return (val < 0 ? "" : "+") + val;
}

function str(value, defaultValue = "") {
    return value || defaultValue;
}

function intSum(v) {
    return Object.values(v).reduce((a, b) => int(a) + int(b));
}

function autoFertigkeit(fertigkeitId, fertigkeit) {
    autoUpdate([
        fertigkeit.Attribute[0].toLowerCase(),
        fertigkeit.Attribute[1].toLowerCase(),
        fertigkeitId + "punkte",
        fertigkeitId + "mod",
        fertigkeitId + "moduser"], v => {
            let update = {};
            update[fertigkeitId] = intSum(v);
            return update;
        });
    allModifier.push(fertigkeitId);
}

function autoKampfFertigkeit(fertigkeitId) {
    autoUpdate([
        fertigkeitId + "punkte",
        fertigkeitId + "mod",
        fertigkeitId + "moduser"], v => {
            let update = {};
            update[fertigkeitId] = intSum(v);
            return update;
        });
    allModifier.push(fertigkeitId);
}

for (var fertigkeitId in splittermond.fertigkeiten) {
    autoFertigkeit(fertigkeitId, splittermond.fertigkeiten[fertigkeitId])
}

for (var fertigkeitId in splittermond.fertigkeiten) {
    autoFertigkeit(fertigkeitId, splittermond.fertigkeiten[fertigkeitId])
}
for (var fertigkeitId in splittermond.magieschulen) {
    autoFertigkeit(fertigkeitId, splittermond.magieschulen[fertigkeitId])
}

for (var fertigkeitId in splittermond.kampffertigkeiten) {
    autoKampfFertigkeit(fertigkeitId);
}

function autoAttribut(attributId) {
    autoUpdate([attributId + "basis", attributId + "mod", attributId + "moduser"], v => {
        let update = {};
        update[attributId] = intSum(v);
        return update;
    });
    autoUpdate([attributId + "start", "heldengrad"], v => {
        let update = {};
        update[attributId + "max"] = int(v[attributId + "start"]) + int(v.heldengrad);
        return update;
    });
    allModifier.push(attributId);
}

for (var attributId in splittermond.attribute) {
    autoAttribut(attributId);
}


on('sheet:opened', function () {
    getAttrs(["abilityroll"], function (v) {
        let update = {};
        if (v.abilityroll == "") {
            update["abilityroll"] = "&{template:splittermond_generic}";
        }
        setAttrs(update);
    });
    getAttrs(["resourceupdated"], function (v) {
        if (+v.resourceupdated == 0) {
            getAttrs(["ansehenswert", "kontaktewert", "standwert", "vermoegenswert"], function (f) {
                let newrowattrs = {};
                let newrowid = generateRowID();
                let ansehen = +f.ansehenswert || 0;
                let kontakte = +f.kontaktewert || 0;
                let stand = +f.standwert || 0;
                let vermoegen = +f.vermoegenswert || 0;
                newrowattrs["repeating_ressources_" + newrowid + "_ressourcename"] = "Ansehen";
                newrowattrs["repeating_ressources_" + newrowid + "_ressourcevalue"] = +ansehen;
                newrowid = generateRowID();
                newrowattrs["repeating_ressources_" + newrowid + "_ressourcename"] = "Kontakte";
                newrowattrs["repeating_ressources_" + newrowid + "_ressourcevalue"] = +kontakte;
                newrowid = generateRowID();
                newrowattrs["repeating_ressources_" + newrowid + "_ressourcename"] = "Stand";
                newrowattrs["repeating_ressources_" + newrowid + "_ressourcevalue"] = +stand;
                newrowid = generateRowID();
                newrowattrs["repeating_ressources_" + newrowid + "_ressourcename"] = "VermÃ¶gen";
                newrowattrs["repeating_ressources_" + newrowid + "_ressourcevalue"] = +vermoegen;
                setAttrs(newrowattrs);
                setAttrs({ resourceupdated: 1 });
            });
        } else {
            return;
        }
    });
});


on("change:epeingesetzt change:epgesamt", function () {
    getAttrs(["epeingesetzt", "epgesamt"], function (values) {
        setAttrs({
            epoffen: values.epgesamt - values.epeingesetzt
        });
        var hg = 1;
        var bonus = 0;
        var sp = 0;
        if (values.epeingesetzt >= 100 && values.epeingesetzt < 300) {
            hg = 2;
            bonus = 2;
            sp = 1;
        }
        if (values.epeingesetzt >= 300 && values.epeingesetzt < 600) {
            hg = 3;
            bonus = 4;
            sp = 2;
        }
        if (values.epeingesetzt >= 600) {
            hg = 4;
            bonus = 6;
            sp = 3;
        }
        setAttrs({
            epoffen: values.epgesamt - values.epeingesetzt,
            heldengrad: hg,
            hiddenvtdhg: bonus,
            hiddenkwhg: bonus,
            hiddengwhg: bonus,
            hiddensplitterpunktehg: sp
        });
    });
});

function getGroessenklasseFromRasse(rasse) {
    rasse = rasse.toLowerCase();
    if (rasse in splittermond.rassen) {
        return int(splittermond.rassen[rasse].groessenklasse) || 5;
    } else {
        return 5;
    }
}

function heldengradBonus(hg) {
    return (int(hg) - 1) * 2;
}



allModifier.push("groessenklasse");
autoUpdate(["rasse", "groessenklassemod", "groessenklassemoduser"], v => ({
    groessenklasse: getGroessenklasseFromRasse(v.rasse) + int(v.groessenklassemod) + int(v.groessenklassemoduser)
}));
allModifier.push("geschwindigkeit");
autoUpdate(["beweglichkeit", "groessenklasse", "geschwindigkeitmod", "geschwindigkeitmoduser"], v => ({
    geschwindigkeit: int(v.beweglichkeit) + int(v.groessenklasse) + int(v.geschwindigkeitmod) + int(v.geschwindigkeitmoduser)
}));
allModifier.push("lebenspunkte");
autoUpdate(["konstitution", "groessenklasse", "lebenspunktemod", "lebenspunktemoduser"], v => ({
    lebenspunkte: int(v.groessenklasse) + int(v.konstitution) + int(v.lebenspunktemod) + int(v.lebenspunktemoduser)
}));
allModifier.push("initiative");
autoUpdate(["intuition", "initiativemod", "initiativemoduser"], v => ({
    initiative: 10 - int(v.intuition) + int(v.initiativemod) + int(v.initiativemoduser)
}));
allModifier.push("fokus");
autoUpdate(["mystik", "willenskraft", "fokusmod", "fokusmoduser"], v => ({
    fokus: (int(v.mystik) + int(v.willenskraft)) * 2 + int(v.fokusmod) + int(v.fokusmoduser)
}));
allModifier.push("koerperlicherwiderstand");
autoUpdate(["konstitution", "willenskraft", "koerperlicherwiderstandmod", "koerperlicherwiderstandmoduser", "heldengrad"], v => ({
    koerperlicherwiderstand: 12 + int(v.konstitution) + int(v.willenskraft) + int(v.koerperlicherwiderstandmod) + int(v.koerperlicherwiderstandmoduser) + heldengradBonus(v.heldengrad)
}));
allModifier.push("geistigerwiderstand");
autoUpdate(["verstand", "willenskraft", "geistigerwiderstandmod", "geistigerwiderstandmoduser", "heldengrad"], v => ({
    geistigerwiderstand: 12 + int(v.verstand) + int(v.willenskraft) + int(v.geistigerwiderstandmod) + int(v.geistigerwiderstandmoduser) + heldengradBonus(v.heldengrad)
}));
allModifier.push("verteidigung");
autoUpdate(["beweglichkeit", "staerke", "groessenklasse", "verteidigungmod", "verteidigungmoduser", "heldengrad"], v => ({
    verteidigung: 12 + int(v.beweglichkeit) + int(v.staerke) + (5 - int(v.groessenklasse)) * 2 + int(v.verteidigungmod) + int(v.verteidigungmoduser) + heldengradBonus(v.heldengrad)
}));


// Calculate modifier from "staerken"
on("change:repeating_staerken remove:repeating_staerken", function () {
    getSectionIDs("repeating_staerken", function (idarray) {

        idAttrsStr = idarray.map(id => "repeating_staerken_" + id + "_staerkename");
        idAttrsStr = idAttrsStr.concat(idarray.map(id => "repeating_staerken_" + id + "_staerkenwert"));
        getAttrs(idAttrsStr, function (v) {
            var staerkenmod = {};

            idarray.forEach(function (id) {
                var staerke = str(v["repeating_staerken_" + id + "_staerkename"]).toLowerCase();
                var staerkenwert = int(v["repeating_staerken_" + id + "_staerkenwert"]);
                if (staerke in splittermond.staerken) {
                    for (var key in splittermond.staerken[staerke].modifier) {
                        var modifier = { name: splittermond.staerken[staerke].tooltip, value: int(splittermond.staerken[staerke].modifier[key]) * staerkenwert };
                        if (!(key in staerkenmod)) {
                            staerkenmod[key] = [];
                        }
                        staerkenmod[key].push(modifier)
                    }
                }
            });
            setAttrs({ staerkenmod: JSON.stringify(staerkenmod) });
        });
    });
});

// Calculate modifier from "zustaende"
on("change:repeating_zustaende remove:repeating_zustaende", function () {
    getSectionIDs("repeating_zustaende", function (idarray) {

        idAttrsStr = idarray.map(id => "repeating_zustaende_" + id + "_zustandsname");
        idAttrsStr = idAttrsStr.concat(idarray.map(id => "repeating_zustaende_" + id + "_zustandsstufe"));
        idAttrsStr = idAttrsStr.concat(idarray.map(id => "repeating_zustaende_" + id + "_zustandonoff"));
        getAttrs(idAttrsStr, function (v) {
            var zustandmod = {};

            idarray.forEach(function (id) {
                var zustand = str(v["repeating_zustaende_" + id + "_zustandsname"]).toLowerCase();
                var zustandwert = int(v["repeating_zustaende_" + id + "_zustandsstufe"]);
                var zustandonoff = int(v["repeating_zustaende_" + id + "_zustandonoff"]);
                if (zustandonoff == 1) {
                    for (var splimoZustand in splittermond.zustaende) {
                        if (zustand.startsWith(splimoZustand) && zustand != "") {
                            for (var key in splittermond.zustaende[splimoZustand].modifier) {
                                var modifier = { name: splittermond.zustaende[splimoZustand].tooltip, value: int(splittermond.zustaende[splimoZustand].modifier[key]) * zustandwert };
                                if (!(key in zustandmod)) {
                                    zustandmod[key] = [];
                                }
                                zustandmod[key].push(modifier);
                            }
                        }
                    }
                }

            });
            setAttrs({ zustaendemod: JSON.stringify(zustandmod) });
        });
    });
});


// Calculate modifier from "Attributmodifikatoren"
on("change:repeating_attributmods remove:repeating_attributmods", function () {
    getSectionIDs("repeating_attributmods", function (idarray) {

        idAttrsStr = idarray.map(id => "repeating_attributmods_" + id + "_modattribut");
        idAttrsStr = idAttrsStr.concat(idarray.map(id => "repeating_attributmods_" + id + "_attributmodname"));
        idAttrsStr = idAttrsStr.concat(idarray.map(id => "repeating_attributmods_" + id + "_attributmod"));
        idAttrsStr = idAttrsStr.concat(idarray.map(id => "repeating_attributmods_" + id + "_attributmodonoff"));
        getAttrs(idAttrsStr, function (v) {
            var attributmod = {};

            idarray.forEach(function (id) {
                var attribut = str(v["repeating_attributmods_" + id + "_modattribut"]);
                var name = str(v["repeating_attributmods_" + id + "_attributmodname"]);
                var modvalue = int(v["repeating_attributmods_" + id + "_attributmod"]);
                var modactive = str(v["repeating_attributmods_" + id + "_attributmodonoff"]);
                if (modactive == "on") {
                    var attribute = []
                    switch (attribut) {
                        case "allwiderstand":
                            attribute = attribute.concat(["verteidigung", "geistigerwiderstand", "koerperlicherwiderstand"]);
                            break;
                        case "allfertigkeiten":
                            attribute = attribute.concat(Object.keys(splittermond.fertigkeiten));
                            attribute = attribute.concat(Object.keys(splittermond.magieschulen));
                            attribute = attribute.concat(Object.keys(splittermond.kampffertigkeiten));
                            break;
                        case "allgfertigkeiten":
                            attribute = attribute.concat(Object.keys(splittermond.fertigkeiten));
                            break;
                        case "kampffertigkeiten":
                            attribute = attribute.concat(Object.keys(splittermond.kampffertigkeiten));
                            break;
                        case "magiefertigkeiten":
                            attribute = attribute.concat(Object.keys(splittermond.magieschulen));
                            break;
                        default:
                            attribute.push(attribut)
                    }
                    for (var attribut of attribute) {
                        var modifier = { name: name, value: modvalue };
                        if (!(attribut in attributmod)) {
                            attributmod[attribut] = [];
                        }
                        attributmod[attribut].push(modifier);
                    }
                }

            });
            setAttrs({ attributmodsmod: JSON.stringify(attributmod) });
        });
    });
});


// Calculate modifier from "zustaende"
on("change:repeating_meisterschaften remove:repeating_meisterschaften", function () {
    getSectionIDs("repeating_meisterschaften", function (idarray) {

        idAttrsStr = idarray.map(id => "repeating_meisterschaften_" + id + "_meisterschaftsname"); getAttrs(idAttrsStr, function (v) {
            var meisterschaftmod = {};

            idarray.forEach(function (id) {
                var meisterschaft = str(v["repeating_meisterschaften_" + id + "_meisterschaftsname"]).toLowerCase();
                for (var splimoMeisterschaft in splittermond.meisterschaften) {
                    if (meisterschaft == splimoMeisterschaft) {
                        for (var key in splittermond.meisterschaften[splimoMeisterschaft].modifier) {
                            var modifier = { name: splittermond.meisterschaften[splimoMeisterschaft].tooltip, value: int(splittermond.meisterschaften[splimoMeisterschaft].modifier[key]) };
                            if (!(key in meisterschaftmod)) {
                                meisterschaftmod[key] = [];
                            }
                            meisterschaftmod[key].push(modifier);
                        }
                    }
                }

            });
            setAttrs({ meisterschaftmod: JSON.stringify(meisterschaftmod) });
        });
    });
});


// Calc "Zauber"
on("change:repeating_zauber:magieschulen", function () {
    getSectionIDs("repeating_zauber", function (idarray) {
        if (idarray.length > 0) {
            var update = {};
            var fields = idarray.map(id => "repeating_zauber_" + id + "_magieschulen");
            fields = fields.concat(Object.keys(splittermond.magieschulen));
            getAttrs(fields, function (v) {
                idarray.forEach(function (id) {
                    update["repeating_zauber_" + id + "_zauberwert"] = v[v["repeating_zauber_" + id + "_magieschulen"]];
                })
                setAttrs(update);
            });
        }
    });
});

// Calc Waffenskill
on("change:repeating_waffen:waffenskill change:repeating_waffen:waffenattr1 change:repeating_waffen:waffenattr2 change:repeating_waffen:waffenmod "
    + Object.keys(splittermond.attribute).map(v => "change:" + v).join(" ")
    + Object.keys(splittermond.kampffertigkeiten).map(v => "change:" + v).join(" "), function () {
        // Nahkampfwaffen
        getSectionIDs("repeating_waffen", function (idarray) {

            if (idarray.length > 0) {
                var update = {};
                var attrArr = [];
                idarray.forEach(function (v) {
                    attrArr.push("repeating_waffen_" + v + "_waffenskill");
                    attrArr.push("repeating_waffen_" + v + "_waffenattr1");
                    attrArr.push("repeating_waffen_" + v + "_waffenattr2");
                    attrArr.push("repeating_waffen_" + v + "_waffenmod");
                });
                attrArr = attrArr.concat(Object.keys(splittermond.attribute));
                attrArr = attrArr.concat(Object.keys(splittermond.kampffertigkeiten));
                getAttrs(attrArr, function (v) {
                    _.each(idarray, function (currentID, i) {
                        var skill = v["repeating_waffen_" + currentID + "_waffenskill"];
                        var attr1 = v["repeating_waffen_" + currentID + "_waffenattr1"];
                        var attr2 = v["repeating_waffen_" + currentID + "_waffenattr2"];
                        var mod = int(v["repeating_waffen_" + currentID + "_waffenmod"]);
                        update["repeating_waffen_" + currentID + "_waffenwert"] = int(v[skill]) + int(v[attr1]) + int(v[attr2]) + mod;
                    });
                    setAttrs(update);
                });
            }
        });
    });
/*
on("change:hiddenschildvtd change:hiddenruestungsvtd change:hiddenruestungssr change:hiddenschildbe change:hiddenruestungsbe change:hiddenschildtickplus change:hiddenruestungstickplus change:hiddensr change:hiddenbehinderungfruehstueck", function (g) {
    getAttrs(["hiddenschildvtd", "hiddenruestungsvtd", "hiddenruestungssr", "hiddenschildbe", "hiddenruestungsbe", "hiddenschildtickplus", "hiddenruestungstickplus", "hiddensr", "hiddenbehinderungfruehstueck", "hiddenschadensreduktionfruehstueck"], function (f) {
        setAttrs({
            gesamtvtd: +f.hiddenschildvtd + +f.hiddenruestungsvtd,
            gesamtsr: +f.hiddenruestungssr + +f.hiddensr + +f.hiddenschadensreduktionfruehstueck,
            gesamtbe: Math.max((+f.hiddenruestungsbe + +f.hiddenschildbe - +f.hiddenbehinderungfruehstueck), 0),
            gesamttickplus: +f.hiddenruestungstickplus + +f.hiddenschildtickplus
        })
    });
});


on("change:gesamtvtd change:gesamtsr change:gesamtbe", function (eventinfo) {
    getAttrs(["gesamtvtd", "gesamtsr", "gesamtbe", "schadensreduktionmod", "hiddenschadensreduktionfruehstueck"], function (values) {
        setAttrs({
            hiddenvtdruestungschild: +values.gesamtvtd,
            schadensreduktion: +values.gesamtsr + +values.schadensreduktionmod + +values.hiddenschadensreduktionfruehstueck,
            behinderung: +values.gesamtbe
        });
    });
});
*/


on("change:lebenspunkte change:lebenspunkte_e change:lebenspunkte_k change:lebenspunkte_v", function (e) {
    getAttrs(["lebenspunkte", "lebenspunkte_e", "lebenspunkte_k", "lebenspunkte_v"], function (v) {
        var temp = (int(v.lebenspunkte) * 5) - int(v.lebenspunkte_e) - int(v.lebenspunkte_k) - int(v.lebenspunkte_v);
        setAttrs({
            lebenspunkte_t: temp,
            lebenspunkte_v_bar: "6".repeat(int(v.lebenspunkte_v)),
            lebenspunkte_k_bar: "6".repeat(int(v.lebenspunkte_k)),
            lebenspunkte_e_bar: "6".repeat(int(v.lebenspunkte_e)),
            lebenspunkte_t_bar: "6".repeat(Math.max(temp, 0))
        });
    });
});


on("change:fokus", function (e) {
    getAttrs(["fokus", "fokus_e", "fokus_k", "fokus_v"], function (v) {
        var temp = int(v.fokus) - int(v.fokus_e) - int(v.fokus_k) - int(v.fokus_v);
        setAttrs({
            fokus_t: temp,
            fokus_v_bar: "6".repeat(int(v.fokus_v)),
            fokus_k_bar: "6".repeat(int(v.fokus_k)),
            fokus_e_bar: "6".repeat(int(v.fokus_e)),
            fokus_t_bar: "6".repeat(Math.max(temp, 0))
        });
    });
});
/*

on("change:repeating_nahkampfwaffen:waffenmerkmale", function (eventInfo) {
    getAttrs(["repeating_nahkampfwaffen_waffenmerkmale"], function (v) {
        let waffenmerkmale = v["repeating_nahkampfwaffen_waffenmerkmale"].toLowerCase().split(",");
        let exakt = 0;
        let scharf = 0;
        let kritisch = 0;
        let defensiv = 0;
        for (var i = 0; i < waffenmerkmale.length; i++) {
            if (waffenmerkmale[i].search("exakt") != -1) {
                exakt = waffenmerkmale[i].slice(6).trim();
            }
            if (waffenmerkmale[i].search("scharf") != -1) {
                scharf = waffenmerkmale[i].slice(7).trim();
            }
            if (waffenmerkmale[i].search("kritisch") != -1) {
                kritisch = waffenmerkmale[i].slice(9).trim();
            }
            if (waffenmerkmale[i].search("defensiv") != -1) {
                defensiv = waffenmerkmale[i].slice(9).trim();
            }
        }
        setAttrs({
            'repeating_nahkampfwaffen_waffenexakt': +exakt,
            'repeating_nahkampfwaffen_waffenscharf': +scharf,
            'repeating_nahkampfwaffen_waffenkritisch': +kritisch,
            'repeating_nahkampfwaffen_waffendefensiv': +defensiv
        });
    });
});


on("change:repeating_nahkampfwaffen:waffenscharf change:repeating_nahkampfwaffen:waffenexakt change:repeating_nahkampfwaffen:waffenkritisch change:repeating_nahkampfwaffen:waffenschaden change:repeating_nahkampfwaffen:waffenname", function (eventInfo) {
    getAttrs(["repeating_nahkampfwaffen_waffenexakt", "repeating_nahkampfwaffen_waffenkritisch", "repeating_nahkampfwaffen_waffenscharf", "repeating_nahkampfwaffen_waffenschaden"], function (v) {
        let exakt = v["repeating_nahkampfwaffen_waffenexakt"];
        let scharf = v["repeating_nahkampfwaffen_waffenscharf"];
        let kritisch = v["repeating_nahkampfwaffen_waffenkritisch"];
        let waffenschaden1 = 1;
        let waffenschadenwuerfel = "d6";
        let waffenschaden3 = 0;
        if (!v["repeating_nahkampfwaffen_waffenschaden"]) {
            v["repeating_nahkampfwaffen_waffenschaden"] = "";
        }
        let temp = v["repeating_nahkampfwaffen_waffenschaden"].match(/([0-9]{0,1})(W6|W10|w6|w10)[ ]*\+{0,1}[ ]*([0-9]*)/);
        if (temp) {
            if (temp[1] == "") {
                temp[1] = 1;
            }

            temp[2] = temp[2].toLowerCase().replace("w", "d");
            waffenschaden1 = +temp[1];
            waffenschadenwuerfel = temp[2];
            waffenschaden3 = +temp[3];

        }

        let die_max = 0;
        let die_minus = 0;
        let damagerollstring;
        if (scharf < 0) { scharf = 0; }
        if (exakt < 0) { exakt = 0; }
        if (kritisch < 0) { kritisch = 0; }
        if (kritisch > 0) {
            damagerollstring = "";
            die_max = waffenschadenwuerfel.substr(1);
            die_minus = +waffenschadenwuerfel.substr(1) - 1;
            if ((+waffenschaden1 + +exakt) == 1) {
                damagerollstring += "{1" + waffenschadenwuerfel + "}<" + +die_minus + "*([[{1d" + +die_minus + "," + scharf + "d1}k1]]-" + (+die_max + +kritisch) + ")+" + (+die_max + +kritisch) + "+" + waffenschaden3;
            } else {
                damagerollstring = "{";
                for (i = 1; i <= +waffenschaden1 + +exakt; i++) {
                    damagerollstring = damagerollstring + "{1" + waffenschadenwuerfel + "}<" + +die_minus + "*([[{1d" + +die_minus + "," + scharf + "d1}k1]]-" + (+die_max + +kritisch) + ")+" + (+die_max + +kritisch) + ",";
                }
                damagerollstring = damagerollstring.slice(0, -1);
                damagerollstring += "}k" + waffenschaden1 + " + " + waffenschaden3;
            }
        } else if (kritisch == 0) {
            damagerollstring = "{";
            for (i = 1; i <= +waffenschaden1 + +exakt; i++) {
                damagerollstring = damagerollstring + "{1" + waffenschadenwuerfel + ", " + scharf + "d1}k1,";
            }
            damagerollstring = damagerollstring.slice(0, -1);
            damagerollstring = damagerollstring + "}k" + waffenschaden1 + " + " + waffenschaden3;
        }
        setAttrs({
            'repeating_nahkampfwaffen_damageroll': damagerollstring
        });
    });
});

on("change:repeating_fernkampfwaffen:waffenmerkmalefern", function (eventInfo) {
    getAttrs(["repeating_fernkampfwaffen_waffenmerkmalefern"], function (v) {
        let waffenmerkmale = v["repeating_fernkampfwaffen_waffenmerkmalefern"].toLowerCase().split(",");
        let exakt = 0;
        let scharf = 0;
        let kritisch = 0;
        for (var i = 0; i < waffenmerkmale.length; i++) {
            if (waffenmerkmale[i].search("exakt") != -1) {
                exakt = waffenmerkmale[i].slice(6).trim();
            }
            if (waffenmerkmale[i].search("scharf") != -1) {
                scharf = waffenmerkmale[i].slice(7).trim();
            }
            if (waffenmerkmale[i].search("kritisch") != -1) {
                kritisch = waffenmerkmale[i].slice(9).trim();
            }
        }
        setAttrs({
            'repeating_fernkampfwaffen_waffenexakt': +exakt,
            'repeating_fernkampfwaffen_waffenscharf': +scharf,
            'repeating_fernkampfwaffen_waffenkritisch': +kritisch
        });
    });
});

on("change:repeating_fernkampfwaffen:waffenscharf change:repeating_fernkampfwaffen:waffenexakt change:repeating_fernkampfwaffen:waffenkritisch change:repeating_fernkampfwaffen:waffenschaden1fern change:repeating_fernkampfwaffen:waffenschadenwuerfelfern change:repeating_fernkampfwaffen:waffenschaden3fern change:repeating_fernkampfwaffen:waffennamefern", function (eventInfo) {
    getAttrs(["repeating_fernkampfwaffen_waffenexakt", "repeating_fernkampfwaffen_waffenscharf", "repeating_fernkampfwaffen_waffenkritisch", "repeating_fernkampfwaffen_waffenschaden1fern", "repeating_fernkampfwaffen_waffenschadenwuerfelfern", "repeating_fernkampfwaffen_waffenschaden3fern"], function (v) {
        let exakt = v["repeating_fernkampfwaffen_waffenexakt"];
        let scharf = v["repeating_fernkampfwaffen_waffenscharf"];
        let kritisch = v["repeating_fernkampfwaffen_waffenkritisch"];
        let waffenschaden1 = v["repeating_fernkampfwaffen_waffenschaden1fern"];
        let waffenschadenwuerfel = v["repeating_fernkampfwaffen_waffenschadenwuerfelfern"];
        let waffenschaden3 = v["repeating_fernkampfwaffen_waffenschaden3fern"];
        if (kritisch > 0) {
            damagerollstring = "";
            die_max = waffenschadenwuerfel.substr(1);
            die_minus = +waffenschadenwuerfel.substr(1) - 1;
            if ((+waffenschaden1 + +exakt) == 1) {
                damagerollstring += "[[{1" + waffenschadenwuerfel + "}<" + +die_minus + "*([[{1d" + +die_minus + "," + scharf + "d1}k1]]-" + (+die_max + +kritisch) + ")+" + (+die_max + +kritisch) + "+" + waffenschaden3 + "]]";
            } else {
                damagerollstring = "[[{";
                for (i = 1; i <= +waffenschaden1 + +exakt; i++) {
                    damagerollstring = damagerollstring + "{1" + waffenschadenwuerfel + "}<" + +die_minus + "*([[{1d" + +die_minus + "," + scharf + "d1}k1]]-" + (+die_max + +kritisch) + ")+" + (+die_max + +kritisch) + ",";
                }
                damagerollstring = damagerollstring.slice(0, -1);
                damagerollstring += "}k" + waffenschaden1 + " + " + waffenschaden3 + "]]";
            }
        } else if (+kritisch == 0) {
            damagerollstring = "{";
            for (i = 1; i <= +waffenschaden1 + +exakt; i++) {
                damagerollstring = damagerollstring + "{1" + waffenschadenwuerfel + ", " + scharf + "d1}k1,";
            }
            damagerollstring = damagerollstring.slice(0, -1);
            damagerollstring = damagerollstring + "}k" + waffenschaden1 + " + " + waffenschaden3;
        }
        setAttrs({
            'repeating_fernkampfwaffen_damagerollfern': damagerollstring
        });
    });
});

*/


on("change:notizen", function (eventInfo) {
    getAttrs(["notizen", "fokus", "lebenspunkte"], function (v) {
        let notizen = v.notizen.toLowerCase();
        if (notizen.startsWith("!setnull(")) {
            switch (notizen.slice(9).slice(0, -1)) {
                case "sr":
                    setAttrs({ hiddensr: 0 });
                    break;
                case "lp":
                    setAttrs({
                        lebenspunkte_k: 0,
                        lebenspunkte_e: 0,
                        lebenspunkte_v: 0,
                        lebenspunkte_t: +v.lebenspunkte * 5
                    });
                    break;
                case "fokus":
                    setAttrs({
                        fokus_k: 0,
                        fokus_e: 0,
                        fokus_v: 0,
                        fokus_t: +v.fokus
                    });
                    break;
                case "gsw":
                    setAttrs({ hiddengsw: 0 });
                    setAttrs({ hiddengswag: 0 });
                    setAttrs({ hiddengswbe: 0 });
                    setAttrs({ hiddengswspr: 0 });
                    break;
                case "gw":
                    setAttrs({ hiddengw: 0 });
                    setAttrs({ hiddengw: 0 });
                    break;
                case "kw":
                    setAttrs({ hiddenkw: 0 });
                    break;
                case "ini":
                    setAttrs({ hiddenini: 0 });
                    break;
                case "schmerzresistenz":
                    setAttrs({ schmerzresistenz: 0 });
                    break;
                case "splitterpunkte":
                    setAttrs({ hiddensplitterpunkte: 0 });
                    break;
                default:
                    setAttrs({ notizen: "Syntax-Fehler!" });
            }
            setAttrs({ notizen: "" });
        }
    });
});

on("clicked:startimport", function (f) {
    getAttrs(["jsonimport"], function (v) {
        importerror = false;
        try {
            var characterData = JSON.parse(v.jsonimport);
        } catch (err) {
            importerror = true;
        }
        if (!importerror && v.jsonimport != "") {
            clearSheet();
            writeToSheet(characterData);
        } else {
            setAttrs({ xmlimport: "Fehler beim Parsen des JSON-Strings!" })
        }
    });
});

function clearSheet() {
    let exp = 0;
    setAttrs({
        ansehenswert: 0,
        kontaktewert: 0,
        standwert: 0,
        vermoegenswert: 0
    });
    getSectionIDs("repeating_ressources", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_ressources_" + idarray[i]);
        }
    });
    setAttrs({
        hiddenlp: 0,
        hiddenfokus: 0,
        hiddengsw: 0,
        hiddengw: 0,
        hiddenkw: 0,
        hiddensr: 0,
        hiddenini: 0,
        schemerzresistenz: 0,
        hiddensplitterpunkte: 0,
        hiddensbm: 0,
        sprintercount: 0
    });
    getSectionIDs("repeating_staerken", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_staerken_" + idarray[i]);
        }
    });
    getSectionIDs("repeating_schwaechen", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_schwaechen_" + idarray[i]);
        }
    });
    setAttrs({
        hiddenausstrahlungmod: 0,
        hiddenbeweglichkeitmod: 0,
        hiddenintuitionmod: 0,
        hiddenkonstitutionmod: 0,
        hiddenmystikmod: 0,
        hiddenstaerkemod: 0,
        hiddenverstandmod: 0,
        hiddenwillenskraftmod: 0
    });
    getSectionIDs("repeating_attributmods", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_attributmods_" + idarray[i]);
        }
    });
    getSectionIDs("repeating_sprachen", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_sprachen_" + idarray[i]);
        }
    });
    getSectionIDs("repeating_kulturkunde", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_kulturkunde_" + idarray[i]);
        }
    });
    getSectionIDs("repeating_nahkampfwaffen", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_nahkampfwaffen_" + idarray[i]);
        }
    });
    getSectionIDs("repeating_fernkampfwaffen", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_fernkampfwaffen_" + idarray[i]);
        }
    });
    setAttrs({
        verwundet: 0,
        benommen: 0,
        geblendet: 0,
        erschoepft: 0,
        lahm: 0
    });
    getSectionIDs("repeating_zustaende", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_zustaende_" + idarray[i]);
        }
    });
    getSectionIDs("repeating_zauber", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_zauber_" + idarray[i]);
        }
    });
    setAttrs({
        gesamtsr: 0,
        gesamtbe: 0,
        schildbe: 0
    });
    getSectionIDs("repeating_ruestungen", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_ruestungen_" + idarray[i]);
        }
    });
    setAttrs({
        hiddeninibr: 0,
        hiddenvtdgr: 0,
        rt1: 0,
        rt2: 0,
        st1: 0,
        st2: 0,
        sw1: 0,
        sw2: 0,
        hiddengswag: 0
    });
    getSectionIDs("repeating_meisterschaften", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_meisterschaften_" + idarray[i]);
        }
    });
    getSectionIDs("repeating_masterytooltips", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_masterytooltips_" + idarray[i]);
        }
    });
    getSectionIDs("repeating_spelltooltips", function (idarray) {
        for (var i = 0; i < idarray.length; i++) {
            removeRepeatingRow("repeating_spelltooltips_" + idarray[i]);
        }
    });
}



on("change:fokus_k change:fokus_e change:fokus_v", function (f) {
    if (f.sourceType == "sheetworker") { return; }
    getAttrs(["fokus_t"], function (v) {
        let newValue = f.newValue || 0;
        let previousValue = f.previousValue || 0;
        setAttrs({
            fokus_t: +v.fokus_t - (+newValue - +previousValue)
        });
    });
});

on("clicked:verschnaufpause", function (f) {
    getAttrs(["fokus_k", "fokus_e", "fokus_k", "fokus_e", "fokus_v", "fokus_t", "lebenspunkte_k", "lebenspunkte_e", "lebenspunkte_v", "lebenspunkte_t", "regbonus", "konstitution", "willenskraft", "lebenspunkte", "fokus", "hiddenfokreg", "hiddenlifereg"], function (v) {
        let update = {};
        let kon = +v.konstitution;
        let wil = +v.willenskraft;
        let lifereg = +v.hiddenlifereg;
        let fokreg = +v.hiddenfokreg;
        let regbonus = +v.regbonus;
        let konbonus = 2;
        let wilbonus = 2;
        update["fokus_t"] = +v.fokus_t;
        update["fokus_v"] = +v.fokus_v;
        update["fokus_e"] = +v.fokus_e;
        update["fokus_k"] = +v.fokus_k;
        update["lebenspunkte_t"] = +v.lebenspunkte_t;
        update["lebenspunkte_v"] = +v.lebenspunkte_v;
        update["lebenspunkte_e"] = +v.lebenspunkte_e;
        update["lebenspunkte_k"] = +v.lebenspunkte_k;
        update["fokus_t"] += update["fokus_e"];
        update["fokus_e"] = 0;
        update["lebenspunkte_t"] += update["lebenspunkte_e"];
        update["lebenspunkte_e"] = 0;
        setAttrs(update);
    });
});

on("clicked:ruhephase", function (f) {
    getAttrs(["fokuskzue", "fokus_k", "fokus_e", "fokus_k", "fokus_e", "fokus_v", "fokus_t", "lebenspunkte_k", "lebenspunkte_e", "lebenspunkte_v", "lebenspunkte_t", "regbonus", "konstitution", "willenskraft", "lebenspunkte", "fokus", "hiddenfokreg", "hiddenlifereg"], function (v) {
        let update = {};
        let kon = +v.konstitution;
        let wil = +v.willenskraft;
        let lifereg = +v.hiddenlifereg;
        let fokreg = +v.hiddenfokreg;
        let regbonus = +v.regbonus;
        let konbonus = 2;
        let wilbonus = 2;
        let liferegtotal = 0;
        let fokregtotal = 0;
        let lebenspunkte_max = 0;
        let fokus_max = +v.fokus;
        let lebenspunkte_gesamt = (+v.lebenspunkte * 5);
        update["fokus_t"] = +v.fokus_t;
        update["fokus_v"] = +v.fokus_v;
        update["fokus_e"] = +v.fokus_e;
        update["fokus_k"] = +v.fokus_k;
        update["lebenspunkte_t"] = +v.lebenspunkte_t;
        update["lebenspunkte_v"] = +v.lebenspunkte_v;
        update["lebenspunkte_e"] = +v.lebenspunkte_e;
        lebenspunkte_max = +lebenspunkte_gesamt - +v.lebenspunkte_k;
        fokus_max = +v.fokus;
        if (lifereg == 1) {
            konbonus = 3;
        }
        if (fokreg == 1) {
            wilbonus = 3;
        }
        liferegtotal = +regbonus + (+kon * +konbonus);
        fokregtotal = (+wil * +wilbonus);
        update["lebenspunkte_t"] += +update["lebenspunkte_e"];
        update["lebenspunkte_e"] = 0;
        if (+liferegtotal > +update["lebenspunkte_v"]) { liferegtotal = +update["lebenspunkte_v"]; }
        if (+update["lebenspunkte_t"] + liferegtotal > +lebenspunkte_max) { liferegtotal = +lebenspunkte_max - +update["lebenspunkte_t"]; }
        update["lebenspunkte_v"] -= +liferegtotal;
        update["lebenspunkte_t"] += +liferegtotal;
        if (v.fokuskzue == true) {
            update["fokus_t"] += +update["fokus_k"];
            update["fokus_k"] = 0;
        } else {
            fokus_max = +v.fokus - +v.fokus_k;
        }
        update["fokus_t"] += +update["fokus_e"];
        update["fokus_e"] = 0;
        if (+fokregtotal > +update["fokus_v"]) { fokregtotal = +update["fokus_v"]; }
        if ((+update["fokus_t"] + +fokregtotal) > fokus_max) { fokregtotal = (+fokus_max - + update["fokus_t"]); }
        update["fokus_v"] -= +fokregtotal;
        update["fokus_t"] += +fokregtotal;
        setAttrs(update);
    });
});

on("clicked:resetfokus", function (f) {
    getAttrs(["fokus"], function (v) {
        setAttrs({
            fokus_e: 0,
            fokus_k: 0,
            fokus_v: 0,
            fokus_t: +v.fokus
        });
    });
});

on("clicked:resetlp", function (f) {
    getAttrs(["lebenspunkte"], function (v) {
        setAttrs({
            lebenspunkte_e: 0,
            lebenspunkte_k: 0,
            lebenspunkte_v: 0,
            lebenspunkte_t: (+v.lebenspunkte * 5)
        });
    });
});

function calculateSpell(costsToCalculate, obj) {
    if (obj == "player") {
        getAttrs(["fokus_v", "fokus_t", "fokus_e", "fokus_k"], function (v) {
            let update = {};
            let zauberkosten = costsToCalculate;
            let fokus_v = +v.fokus_v;
            let fokus_e = +v.fokus_e;
            let fokus_t = +v.fokus_t;
            let fokus_k = +v.fokus_k;
            let kosten_e = 0;
            let kosten_k = 0;
            let kosten_v = 0;
            let gesamtkosten = 0;
            let temp = zauberkosten.toString().match(/\d{1,2}|[K,k]\d{1,2}|[V,v]\d{1,2}/g);
            var i;
            for (i = 0; i < temp.length; i++) {
                if (temp[i].charAt(0).toLowerCase() == "k") {
                    temp[i] = temp[i].substr(1);
                    kosten_k = temp[i];
                } else if (temp[i].charAt(0).toLowerCase() == "v") {
                    temp[i] = temp[i].substr(1);
                    kosten_v = temp[i];
                } else {
                    kosten_e = temp[i];
                }
            }
            if (kosten_k != 0 && kosten_v != 0) {
                kosten_k -= kosten_v;
            } else if (kosten_k == 0 && kosten_v != 0) {
                kosten_e -= kosten_v;
            }
            gesamtkosten = +kosten_e + +kosten_v + +kosten_k;
            update["zauberkosten"] = 0;
            if (+fokus_t >= +gesamtkosten) {
                update["fokus_e"] = +v.fokus_e + +kosten_e;
                update["fokus_v"] = +v.fokus_v + +kosten_v;
                update["fokus_k"] = +v.fokus_k + +kosten_k;
                update["fokus_t"] = +v.fokus_t - +gesamtkosten;
            }
            setAttrs(update);
        });
    } else if (obj == "nsc") {
        getAttrs(["fokusnsc_v", "foknscgesamt", "fokusnsc_e", "fokusnsc_k"], function (v) {
            let update = {};
            let zauberkosten = costsToCalculate;
            let fokus_v = +v.fokusnsc_v;
            let fokus_e = +v.fokusnsc_e;
            let fokus_t = +v.foknscgesamt;
            let fokus_k = +v.fokusnsc_k;
            let kosten_e = 0;
            let kosten_k = 0;
            let kosten_v = 0;
            let gesamtkosten = 0;
            let temp = zauberkosten.toString().match(/\d{1,2}|[K,k]\d{1,2}|[V,v]\d{1,2}/g);
            var i;
            for (i = 0; i < temp.length; i++) {
                if (temp[i].charAt(0).toLowerCase() == "k") {
                    temp[i] = temp[i].substr(1);
                    kosten_k = temp[i];
                } else if (temp[i].charAt(0).toLowerCase() == "v") {
                    temp[i] = temp[i].substr(1);
                    kosten_v = temp[i];
                } else {
                    kosten_e = temp[i];
                }
            }
            if (kosten_k != 0 && kosten_v != 0) {
                kosten_k -= kosten_v;
            } else if (kosten_k == 0 && kosten_v != 0) {
                kosten_e -= kosten_v;
            }
            gesamtkosten = +kosten_e + +kosten_v + +kosten_k;
            update["zauberkosten"] = 0;
            if (+fokus_t >= +gesamtkosten) {
                update["fokusnsc_e"] = +fokus_e + +kosten_e;
                update["fokusnsc_v"] = +fokus_v + +kosten_v;
                update["fokusnsc_k"] = +fokus_k + +kosten_k;
                update["foknscgesamt"] = +fokus_t - +gesamtkosten;
            }
            setAttrs(update);
        });
    }
}

on("clicked:zaubercalc", function (f) {
    getAttrs(["zauberkosten"], function (v) {
        calculateSpell(v.zauberkosten, "player");
    });
});

on("change:gmroll", function (f) {
    getAttrs(["gmroll"], function (v) {
        let rollstring = "";
        if (v.gmroll == "nogm") {
            rollstring = "&{template:splittermond_generic}";
        } else if (v.gmroll == "gm") {
            rollstring = "/w GM &{template:splittermond_generic}";
        }
        setAttrs({
            abilityroll: rollstring
        });
    });
});

on("change:repeating_zauber:directcalc", function (f) {
    getAttrs(["repeating_zauber_directcalc", "repeating_zauber_zauberkosten"], function (values) {
        var update = {};
        var kosten = values.repeating_zauber_zauberkosten;
        if (values.repeating_zauber_directcalc == "directcalc") {
            update["repeating_zauber_directcalc"] = "off";
            setAttrs(update);
            calculateSpell(kosten, "player");
        }
    });
});

on("change:repeating_zauber:directcalcv", function (f) {
    getAttrs(["repeating_zauber_directcalcv", "repeating_zauber_zauberkostenv"], function (values) {
        var update = {};
        var kosten = values.repeating_zauber_zauberkostenv;
        if (values.repeating_zauber_directcalcv == "directcalc") {
            update["repeating_zauber_directcalcv"] = "off";
            setAttrs(update);
            calculateSpell(kosten, "player");
        }
    });
});


on("change:hiddensbm", function (f) {
    getAttrs(["hiddensbm"], function (v) {
        if (+v.hiddensbm > 1) {
            setAttrs({
                hiddensbm: 1
            });
        }
    });
});


on("clicked:addschaden", function (e) {
    getAttrs(["anzahlschaden", "anzahlschadenart", "lebenspunkte", "lebenspunkte_v", "lebenspunkte_e", "lebenspunkte_k"], function (v) {
        var schaden_v = 0;
        var schaden_e = 0;
        var schaden_k = 0;
        var gesamtSchaden = int(v.lebenspunkte_v) + int(v.lebenspunkte_e) + int(v.lebenspunkte_k);

        switch (v.anzahlschadenart) {
            case "e":
                schaden_e = int(v.anzahlschaden);
                var diff = Math.min(Math.max(gesamtSchaden + schaden_e - int(v.lebenspunkte) * 5, 0), schaden_e);
                schaden_v += diff;
                schaden_e -= diff;
                break;
            case "k":
                schaden_k = int(v.anzahlschaden);
                var diff = Math.min(Math.max(gesamtSchaden + schaden_k - int(v.lebenspunkte) * 5, 0), schaden_k);
                schaden_v += diff;
                schaden_k -= diff;
                break;
            default:
                schaden_v = int(v.anzahlschaden);
                break;
        }

        setAttrs({
            lebenspunkte_v: int(v.lebenspunkte_v) + schaden_v,
            lebenspunkte_e: int(v.lebenspunkte_e) + schaden_e,
            lebenspunkte_k: int(v.lebenspunkte_k) + schaden_k,
        });

    })
});

on("clicked:removeschaden", function (e) {
    getAttrs(["anzahlschaden", "anzahlschadenart", "lebenspunkte", "lebenspunkte_v", "lebenspunkte_e", "lebenspunkte_k"], function (v) {
        var schaden_v = 0;
        var schaden_e = 0;
        var schaden_k = 0;

        switch (v.anzahlschadenart) {
            case "e":
                schaden_e = -int(v.anzahlschaden);
                break;
            case "k":
                schaden_k = -int(v.anzahlschaden);
                break;
            default:
                schaden_v = -int(v.anzahlschaden);
                break;
        }

        setAttrs({
            lebenspunkte_v: Math.max(int(v.lebenspunkte_v) + schaden_v, 0),
            lebenspunkte_e: Math.max(int(v.lebenspunkte_e) + schaden_e, 0),
            lebenspunkte_k: Math.max(int(v.lebenspunkte_k) + schaden_k, 0)
        });

    })
});


on("change:lebenspunkte_v", function (eventInfo) {
    oldLebenspunkte_v = int(eventInfo.previousValue);
    getAttrs(["lebenspunkte_v", "lebenspunkte_t", "lebenspunkte"], function (v) {
        var oldGesundheitsstufe = Math.min(Math.max(Math.ceil(oldLebenspunkte_v / int(v.lebenspunkte)), 1), 6);
        var gesundheitsstufe = Math.min(Math.max(Math.ceil(int(v.lebenspunkte_v) / int(v.lebenspunkte)), 1), 6);
        let lp_v = int(v.lebenspunkte_v);
        let lp_t = +v.lebenspunkte_t;
        let dead = (+v.lebenspunkte * 6) + 1;
        var update = {};
        if (oldGesundheitsstufe == 4 && gesundheitsstufe == 5) {
            let newrowid = generateRowID();
            update["repeating_zustaende_" + newrowid + "_zustandsname"] = "sterbend (Gesundheitsst.)";
            update["repeating_zustaende_" + newrowid + "_zustandsstufe"] = 2;
            update["repeating_zustaende_" + newrowid + "_zustandonoff"] = 1;
        }
        if (oldGesundheitsstufe == 5 && gesundheitsstufe == 6) {
            let newrowid = generateRowID();
            update["repeating_zustaende_" + newrowid + "_zustandsname"] = "sterbend (Gesundheitsst.)";
            update["repeating_zustaende_" + newrowid + "_zustandsstufe"] = 3;
            update["repeating_zustaende_" + newrowid + "_zustandonoff"] = 1;
            newrowid = generateRowID();
            update["repeating_zustaende_" + newrowid + "_zustandsname"] = "bewusstlos (Gesundheitsst.)";
            update["repeating_zustaende_" + newrowid + "_zustandsstufe"] = 1;
            update["repeating_zustaende_" + newrowid + "_zustandonoff"] = 1;
        }
        if (lp_v >= (+v.lebenspunkte * 6)) {
            let newrowid = generateRowID();
            update["repeating_zustaende_" + newrowid + "_zustandsname"] = "tot (Gesundheitsst.)";
            update["repeating_zustaende_" + newrowid + "_zustandsstufe"] = 1;
            update["repeating_zustaende_" + newrowid + "_zustandonoff"] = 1;
        }
        update.gesundheitsstufe = gesundheitsstufe;
        setAttrs(update);
    });
});

allModifier.push("gesundheitsstufe");
allModifier.push("wundabzug");
autoUpdate(["gesundheitsstufe", "gesundheitsstufemod", "wundabzugmod", "wundabzugmoduser"], v => ({
    wundabzug: Math.min(Math.max(Math.floor(Math.pow(2, Math.max(Math.min(int(v.gesundheitsstufe) + int(v.gesundheitsstufemod) - 1, 5), 0) - 1)) + int(v.wundabzugmod) + int(v.wundabzugmoduser), 0), 8)
}));



on("change:rolldamagecheck change:rolldamagensccheck", function (eventInfo) {
    getAttrs(["rolldamagensccheck", "rolldamagecheck"], function (v) {
        let damagensc = "";
        let damagescnah = "";
        let damagescfern = "";
        let update = {};
        if (eventInfo.sourceAttribute == "rolldamagecheck") {
            if (v.rolldamagecheck == true) {
                damagescnah = "[Wirf!](~repeating_nahkampfwaffen_show_damage)";
                damagescfern = "[Wirf!](~repeating_fernkampfwaffen_show_damage)";
            } else {
                damagescnah = "[[@{damageroll}]]";
                damagescfern = "[[@{damagerollfern}]]";
            }
            getSectionIDs("repeating_nahkampfwaffen", function (idarray) {
                _.each(idarray, function (currentID, i) {
                    update["repeating_nahkampfwaffen_" + currentID + "_rolldamage"] = damagescnah;
                    setAttrs(update);
                });
            });
            getSectionIDs("repeating_fernkampfwaffen", function (idarray) {
                _.each(idarray, function (currentID, i) {
                    update["repeating_fernkampfwaffen_" + currentID + "_rolldamagefern"] = damagescfern;
                    setAttrs(update);
                });
            });
        } else {
            if (v.rolldamagensccheck == true) {
                damagensc = "[Wirf!](~repeating_waffennsc_show_damage)";
            } else {
                damagensc = "[[@{damagerollnsc}]]";
            }
            getSectionIDs("repeating_waffennsc", function (idarray) {
                _.each(idarray, function (currentID, i) {
                    update["repeating_waffennsc_" + currentID + "_rolldamagensc"] = damagensc;
                    setAttrs(update);
                });
            });
        }
    });
});



on("change:repeating_ausruestung:last change:repeating_ausruestung:getragen change:repeating_ausruestung:anzahl remove:repeating_ausruestung change:repeating_behaelter1:last change:repeating_behaelter1:getragen change:repeating_behaelter1:anzahl remove:repeating_behaelter1 change:repeating_behaelter2:last change:repeating_behaelter2:getragen change:repeating_behaelter2:anzahl remove:repeating_behaelter2 change:repeating_behaelter3:last change:repeating_behaelter3:getragen change:repeating_behaelter3:anzahl remove:repeating_behaelter3 change:repeating_behaelter4:last change:repeating_behaelter4:getragen change:repeating_behaelter4:anzahl remove:repeating_behaelter4 change:repeating_behaelter5:last change:repeating_behaelter5:getragen change:repeating_behaelter5:anzahl remove:repeating_behaelter5", function (eventInfo) {
    let row = eventInfo.sourceAttribute.split("_")[1];
    let lastfelder = { "ausruestung": "gesamtlast_koerper", "behaelter1": "gesamtlast_behaelter1", "behaelter2": "gesamtlast_behaelter2", "behaelter3": "gesamtlast_behaelter3", "behaelter4": "gesamtlast_behaelter4", "behaelter5": "gesamtlast_behaelter5" };
    let lastfeld = lastfelder[row];
    getSectionIDs(`repeating_${row}`, function (idarray) {
        if (idarray.length > 0) {
            var attrArr = [];
            idarray.forEach(function (currentID) {
                attrArr.push(`repeating_${row}_` + currentID + `_last`);
                attrArr.push(`repeating_${row}_` + currentID + `_getragen`);
                attrArr.push(`repeating_${row}_` + currentID + `_anzahl`);
            });
            getAttrs(attrArr, function (v) {
                var sum = 0;
                idarray.forEach(function (currentID) {
                    var last = v[`repeating_${row}_` + currentID + `_last`];
                    var getragen = v[`repeating_${row}_` + currentID + `_getragen`];
                    var anzahl = v[`repeating_${row}_` + currentID + `_anzahl`];
                    sum += int(last) * int(anzahl) * int(getragen);
                });
                var update = {};
                update[`${lastfeld}`] = sum;
                setAttrs(update);
            });
        } else {
            var update = {}
            update[`${lastfeld}`] = 0;
            setAttrs(update);
        }
    });
});

on("change:gesamtlast_koerper change:gesamtlast_behaelter1 change:gesamtlast_behaelter2 change:gesamtlast_behaelter3 change:gesamtlast_behaelter4 change:gesamtlast_behaelter4", function (eventInfo) {
    getAttrs(["gesamtlast_koerper", "gesamtlast_behaelter1", "gesamtlast_behaelter2", "gesamtlast_behaelter3", "gesamtlast_behaelter4", "gesamtlast_behaelter5"], function (v) {
        let sum = +v.gesamtlast_koerper + +v.gesamtlast_behaelter1 + +v.gesamtlast_behaelter2 + +v.gesamtlast_behaelter3 + +v.gesamtlast_behaelter4 + +v.gesamtlast_behaelter5;
        let update = {};
        update["gesamtlast"] = sum;
        setAttrs(update);
    });
});


//update Schadensreduktion, Behinderung, Tick+, VTD+
["sr", "be", "tickplus", "vtd"].forEach(function (type) {
    allModifier.push("ruestungs" + type);
    allModifier.push("schild" + type);
    on(`change:repeating_ruestungen change:schild${type} change:ruestungs${type}mod change:schild${type}mod change:schildonoff`, function () {
        getSectionIDs("repeating_ruestungen", function (rid) {
            var fields = [`ruestungs${type}mod`, `ruestungs${type}modtooltip`, `schild${type}mod`, `schild${type}modtooltip`, `schild${type}`, "schildonoff"];
            fields = fields.concat(rid.map(v => `repeating_ruestungen_${v}_ruestungs${type}`));
            fields = fields.concat(rid.map(v => `repeating_ruestungen_${v}_ruestungonoff`));
            getAttrs(fields, function (v) {
                var val = 0;
                var tooltip = "";
                rid.forEach(function (rowid) {
                    val = (v[`repeating_ruestungen_${rowid}_ruestungonoff`] == "1") ? int(val) + Math.max(int(v[`repeating_ruestungen_${rowid}_ruestungs${type}`]) + int(v[`ruestungs${type}mod`]), 0) : val;
                    tooltip += (v[`repeating_ruestungen_${rowid}_ruestungonoff`] == "1") ? v[`ruestungs${type}modtooltip`] + "\n" : "";
                });
                val += ((v["schildonoff"] == "1") ? Math.max(int(v[`schild${type}`]) + int(v[`schild${type}mod`]), 0) : 0);
                tooltip += (v["schildonoff"] == "1") ? v[`schild${type}modtooltip`] + "\n" : "";
                var update = {};
                update["ruestung" + type] = val;
                update["ruestung" + type + "modtooltip"] = tooltip;
                setAttrs(update);
            });
        })
    });
});

on("change:repeating_waffen remove:repeating_waffen sheet:opened", function () {
    getSectionIDs("repeating_aawaffen", function (idarray) {
        idarray.forEach(function (v) {
            removeRepeatingRow("repeating_aawaffen_" + v);
        });

        getSectionIDs("repeating_waffen", function (idarray) {
            var fields = idarray.map(v => `repeating_waffen_${v}_waffenname`);
            fields = fields.concat(idarray.map(v => `repeating_waffen_${v}_waffenwert`));
            getAttrs(fields, function (vw) {
                var update = {};
                idarray.forEach(function (id) {
                    if (str(vw[`repeating_waffen_${id}_waffenname`]) != "" || int(vw[`repeating_waffen_${id}_waffenwert`]) > 0) {
                        var newrowid = generateRowID();
                        update[`repeating_aawaffen_${newrowid}_aawaffe`] = str(vw[`repeating_waffen_${id}_waffenname`]);
                        update[`repeating_aawaffen_${newrowid}_aawert`] = str(vw[`repeating_waffen_${id}_waffenwert`]);
                    }
                });
                setAttrs(update);
            });
        });
    });

});

autoUpdate(["ruestungbe"], v => ({
    behinderung: v.ruestungbe
}));


// Update internal modifier
on("change:staerkenmod change:attributmodsmod change:groessenklasse change:zustaendemod change:meisterschaftmod change:wundabzug change:ruestungvtd change:behinderung", function () {
    getAttrs(["staerkenmod", "attributmodsmod", "groessenklasse", "wundabzug", "zustaendemod", "meisterschaftmod", "ruestungvtd", "behinderung"], function (v) {
        var allmod = [JSON.parse(v.staerkenmod), JSON.parse(v.attributmodsmod), JSON.parse(v.zustaendemod), JSON.parse(v.meisterschaftmod)]
        var update = {};
        allModifier.forEach(function (v) {
            var modifier = v + "mod";
            update[modifier + "tooltip"] = "";
            update[modifier] = 0;
            allmod.forEach(function (modobj) {
                if (v in modobj) {
                    modobj[v].forEach(function (v) {
                        update[modifier] += int(v.value);
                        update[modifier + "tooltip"] += `\n${modStr(v.value)} (${v.name})`;
                    })
                }
            })

        });

        var heimlichkeitmodgk = -(int(v.groessenklasse) - 5);
        update["heimlichkeitmod"] += heimlichkeitmodgk;
        if (heimlichkeitmodgk != 0) {
            update["heimlichkeitmodtooltip"] = `\n${heimlichkeitmodgk} (GK)`
        }

        //wundabzug
        if (int(v.wundabzug) > 0) {
            var attr = Object.keys(splittermond.fertigkeiten);
            attr = attr.concat(Object.keys(splittermond.magieschulen));
            attr = attr.concat(Object.keys(splittermond.kampffertigkeiten));
            attr.push("initiative");
            attr.forEach(function (f) {
                update[f + "mod"] -= int(v.wundabzug);
                update[f + "modtooltip"] += `\n${modStr(-int(v.wundabzug))} (Wundabzug)`;
            })
        }

        //AusrÃ¼stung VTD+
        if (int(v.ruestungvtd) != 0) {
            update["verteidigungmod"] += int(v.ruestungvtd);
            update["verteidigungmodtooltip"] += `\n${modStr(int(v.ruestungvtd))} (Schild & RÃ¼stung)`;
        }

        //Behinderung
        if (int(v.behinderung) != 0) {
            ["athletik", "akrobatik", "fingerfertigkeit", "heimlichkeit", "schloesserundfallen", "seefahrt", "tierfuehrung"].forEach(function (attr) {
                update[attr + "mod"] -= int(v.behinderung);
                update[attr + "modtooltip"] += `\n${modStr(-int(v.behinderung))} (Behinderung)`;
            });
            if (Math.floor(int(v.behinderung) / 2) > 0) {
                var val = Math.floor(int(v.behinderung) / 2);
                update["geschwindigkeitmod"] -= val;
                update["geschwindigkeitmodtooltip"] += `\n${modStr(-val)} (Behinderung)`;
            }

        }
        setAttrs(update);
    });
});

// Update Tooltips
allModifier.forEach(function (attr) {
    on(`change:${attr} change:${attr}mod change:${attr}moduser change:${attr}modtooltip`, function (e) {
        getAttrs([attr, attr + "mod", attr + "modtooltip", attr + "moduser"], function (v) {
            var tooltip = "Basis: " + (int(v[attr]) - int(v[attr + "mod"]) - int(v[attr + "moduser"])) + str(v[attr + "modtooltip"]);
            if (int(v[attr + "moduser"]) != 0) {
                tooltip += "\n" + modStr(v[attr + "moduser"]) + " (mod.)"
            }

            var update = {};
            update[attr + "tooltip"] = tooltip;
            setAttrs(update);
        });
    });
});

</script>
            </div>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>